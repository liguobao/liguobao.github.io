<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='ä¸€æ¬¡ä¾èµ–æ³¨å…¥ä¸æ…å¼•å‘çš„ä¸€è¿ä¸²äº‹æ•…ã€‚\nèµ·å› å’Œç°è±¡ å¶å°”ä¼šçœ‹åˆ°çº¿ä¸ŠæœåŠ¡å¯åŠ¨çš„æ—¶å€™ç¬¬ä¸€æ³¢æµé‡è¿›æ¥ä¹‹åï¼Œ\nè¿Ÿè¿Ÿæ²¡æœ‰ä»»ä½•çš„å“åº”ï¼ŒåŒæ—¶æœåŠ¡çš„ç›‘æ§æ£€æŸ¥æ¥å£æ­£å¸¸ï¼Œ\næ‰€ä»¥ K8S é›†ç¾¤è®¤ä¸ºæœåŠ¡æ­£å¸¸ï¼Œç»§ç»­æ”¾å…¥æµé‡ã€‚\næŸ¥çœ‹æ—¥å¿—åŸºæœ¬å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 [2020-06-05T13:00:30.7080743+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test [2020-06-05T13:00:30.7081525+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:31.7074253+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR21" started. [2020-06-05T13:00:31.7077051+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:31.7077942+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:32.2103440+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR22" started. [2020-06-05T13:00:32.2118432+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:32.2125894+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-ba&#39;lan&#39;ce does not match a supported file type [2020-06-05T13:00:33.2223942+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR23" started. [2020-06-05T13:00:33.2238736+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:33.2243808+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:34.2177528+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR24" started. [2020-06-05T13:00:34.2189073+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:34.2193483+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:35.2169806+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR25" started. [2020-06-05T13:00:35.2178259+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:35.2181055+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:36.2183025+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR26" started. [2020-06-05T13:00:36.2195050+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:36.2199702+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:37.2373822+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR27" started. å¼•å‘çš„å‡ ç§åæœ å®¢æˆ·ç«¯è°ƒç”¨è¶…æ—¶ ç»è¿‡äº† 30S ç”šè‡³æ›´é•¿æ—¶é—´åçœ‹åˆ°å¤§é‡çš„æ•°æ®åº“è¿æ¥è¢«åˆå§‹åŒ–ï¼Œç„¶åå¼€å§‹é›†ä¸­å¼è¿”å›ã€‚\n'><title>ä¸€æ¬¡ä¾èµ–æ³¨å…¥ä¸æ…å¼•å‘çš„ä¸€è¿ä¸²äº‹æ•…</title><link rel=canonical href=https://liguobao.github.io/zh/p/%E4%B8%80%E6%AC%A1%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E4%B8%8D%E6%85%8E%E5%BC%95%E5%8F%91%E7%9A%84%E4%B8%80%E8%BF%9E%E4%B8%B2%E4%BA%8B%E6%95%85/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="ä¸€æ¬¡ä¾èµ–æ³¨å…¥ä¸æ…å¼•å‘çš„ä¸€è¿ä¸²äº‹æ•…"><meta property='og:description' content='ä¸€æ¬¡ä¾èµ–æ³¨å…¥ä¸æ…å¼•å‘çš„ä¸€è¿ä¸²äº‹æ•…ã€‚\nèµ·å› å’Œç°è±¡ å¶å°”ä¼šçœ‹åˆ°çº¿ä¸ŠæœåŠ¡å¯åŠ¨çš„æ—¶å€™ç¬¬ä¸€æ³¢æµé‡è¿›æ¥ä¹‹åï¼Œ\nè¿Ÿè¿Ÿæ²¡æœ‰ä»»ä½•çš„å“åº”ï¼ŒåŒæ—¶æœåŠ¡çš„ç›‘æ§æ£€æŸ¥æ¥å£æ­£å¸¸ï¼Œ\næ‰€ä»¥ K8S é›†ç¾¤è®¤ä¸ºæœåŠ¡æ­£å¸¸ï¼Œç»§ç»­æ”¾å…¥æµé‡ã€‚\næŸ¥çœ‹æ—¥å¿—åŸºæœ¬å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 [2020-06-05T13:00:30.7080743+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test [2020-06-05T13:00:30.7081525+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:31.7074253+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR21" started. [2020-06-05T13:00:31.7077051+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:31.7077942+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:32.2103440+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR22" started. [2020-06-05T13:00:32.2118432+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:32.2125894+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-ba&#39;lan&#39;ce does not match a supported file type [2020-06-05T13:00:33.2223942+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR23" started. [2020-06-05T13:00:33.2238736+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:33.2243808+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:34.2177528+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR24" started. [2020-06-05T13:00:34.2189073+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:34.2193483+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:35.2169806+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR25" started. [2020-06-05T13:00:35.2178259+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:35.2181055+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:36.2183025+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR26" started. [2020-06-05T13:00:36.2195050+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:36.2199702+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:37.2373822+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR27" started. å¼•å‘çš„å‡ ç§åæœ å®¢æˆ·ç«¯è°ƒç”¨è¶…æ—¶ ç»è¿‡äº† 30S ç”šè‡³æ›´é•¿æ—¶é—´åçœ‹åˆ°å¤§é‡çš„æ•°æ®åº“è¿æ¥è¢«åˆå§‹åŒ–ï¼Œç„¶åå¼€å§‹é›†ä¸­å¼è¿”å›ã€‚\n'><meta property='og:url' content='https://liguobao.github.io/zh/p/%E4%B8%80%E6%AC%A1%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E4%B8%8D%E6%85%8E%E5%BC%95%E5%8F%91%E7%9A%84%E4%B8%80%E8%BF%9E%E4%B8%B2%E4%BA%8B%E6%95%85/'><meta property='og:site_name' content='äººç”Ÿåˆ é™¤æŒ‡å—'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='DI'><meta property='article:tag' content='ä¾èµ–æ³¨å…¥'><meta property='article:tag' content='.NET Core'><meta property='article:tag' content='å¼‚æ­¥ç¼–ç¨‹'><meta property='article:published_time' content='2020-06-07T00:00:00+00:00'><meta property='article:modified_time' content='2020-06-07T00:00:00+00:00'><meta name=twitter:title content="ä¸€æ¬¡ä¾èµ–æ³¨å…¥ä¸æ…å¼•å‘çš„ä¸€è¿ä¸²äº‹æ•…"><meta name=twitter:description content='ä¸€æ¬¡ä¾èµ–æ³¨å…¥ä¸æ…å¼•å‘çš„ä¸€è¿ä¸²äº‹æ•…ã€‚\nèµ·å› å’Œç°è±¡ å¶å°”ä¼šçœ‹åˆ°çº¿ä¸ŠæœåŠ¡å¯åŠ¨çš„æ—¶å€™ç¬¬ä¸€æ³¢æµé‡è¿›æ¥ä¹‹åï¼Œ\nè¿Ÿè¿Ÿæ²¡æœ‰ä»»ä½•çš„å“åº”ï¼ŒåŒæ—¶æœåŠ¡çš„ç›‘æ§æ£€æŸ¥æ¥å£æ­£å¸¸ï¼Œ\næ‰€ä»¥ K8S é›†ç¾¤è®¤ä¸ºæœåŠ¡æ­£å¸¸ï¼Œç»§ç»­æ”¾å…¥æµé‡ã€‚\næŸ¥çœ‹æ—¥å¿—åŸºæœ¬å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 [2020-06-05T13:00:30.7080743+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test [2020-06-05T13:00:30.7081525+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:31.7074253+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR21" started. [2020-06-05T13:00:31.7077051+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:31.7077942+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:32.2103440+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR22" started. [2020-06-05T13:00:32.2118432+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:32.2125894+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-ba&#39;lan&#39;ce does not match a supported file type [2020-06-05T13:00:33.2223942+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR23" started. [2020-06-05T13:00:33.2238736+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:33.2243808+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:34.2177528+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR24" started. [2020-06-05T13:00:34.2189073+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:34.2193483+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:35.2169806+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR25" started. [2020-06-05T13:00:35.2178259+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:35.2181055+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:36.2183025+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR26" started. [2020-06-05T13:00:36.2195050+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance [2020-06-05T13:00:36.2199702+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type [2020-06-05T13:00:37.2373822+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id "0HM09A1MAAR27" started. å¼•å‘çš„å‡ ç§åæœ å®¢æˆ·ç«¯è°ƒç”¨è¶…æ—¶ ç»è¿‡äº† 30S ç”šè‡³æ›´é•¿æ—¶é—´åçœ‹åˆ°å¤§é‡çš„æ•°æ®åº“è¿æ¥è¢«åˆå§‹åŒ–ï¼Œç„¶åå¼€å§‹é›†ä¸­å¼è¿”å›ã€‚\n'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/zh/><img src=/img/zhihu-lgb_hu_2ad0a9defe137384.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/zh>äººç”Ÿåˆ é™¤æŒ‡å—</a></h1><h2 class=site-description>liguobao</h2></div></header><ol class=menu-social><li><a href=https://github.com/liguobao target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/Liguobao2049 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://www.zhihu.com/people/codelover target=_blank title=çŸ¥ä¹ rel=me><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/zh/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/zh/liguobao-resume/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>About</span></a></li><li><a href=/zh/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/zh/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://liguobao.github.io/zh/ selected>ç®€ä½“ä¸­æ–‡</option><option value=https://liguobao.github.io/>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#èµ·å› å’Œç°è±¡>èµ·å› å’Œç°è±¡</a><ol><li><a href=#å¼•å‘çš„å‡ ç§åæœ>å¼•å‘çš„å‡ ç§åæœ</a><ol><li><a href=#å®¢æˆ·ç«¯è°ƒç”¨è¶…æ—¶>å®¢æˆ·ç«¯è°ƒç”¨è¶…æ—¶</a></li><li><a href=#æ•°æ®åº“è¿æ¥æš´æ¶¨>æ•°æ®åº“è¿æ¥æš´æ¶¨</a></li><li><a href=#å¼•å‘æœåŠ¡é›ªå´©æ•ˆåº”æœåŠ¡ä¸å¯ç”¨>å¼•å‘æœåŠ¡â€œé›ªå´©â€æ•ˆåº”ï¼ŒæœåŠ¡ä¸å¯ç”¨</a></li></ol></li></ol></li><li><a href=#æ’æŸ¥é—®é¢˜>æ’æŸ¥é—®é¢˜</a><ol><li><a href=#æ•°æ®åº“çš„é—®é¢˜->æ•°æ®åº“çš„é—®é¢˜ ï¼Ÿ</a></li><li><a href=#æ•°æ®åº“é©±åŠ¨æˆ–è€…-ef-core-æ¡†æ¶çš„é—®é¢˜>æ•°æ®åº“é©±åŠ¨æˆ–è€… EF Core æ¡†æ¶çš„é—®é¢˜ï¼Ÿ</a></li><li><a href=#ç©¶ç«Ÿæ•°æ®åº“é©±åŠ¨æœ‰æ²¡æœ‰é—®é¢˜>ç©¶ç«Ÿæ•°æ®åº“é©±åŠ¨æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿ</a></li></ol></li><li><a href=#æŸç§çŒœæµ‹>æŸç§çŒœæµ‹</a><ol><li><a href=#è‚¯å®šæ˜¯æœ‰ä»€ä¹ˆå¥‡æ€ªçš„è¡Œä¸ºé˜»å¡äº†å½“å‰æœåŠ¡è¿›ç¨‹>è‚¯å®šæ˜¯æœ‰ä»€ä¹ˆå¥‡æ€ªçš„è¡Œä¸ºé˜»å¡äº†å½“å‰æœåŠ¡è¿›ç¨‹ï¼Œ</a></li><li><a href=#å¯¼è‡´æ•°æ®åº“è¿æ¥çš„æ—¥å¿—ä¹Ÿæ²¡æœ‰è¾“å‡º>å¯¼è‡´æ•°æ®åº“è¿æ¥çš„æ—¥å¿—ä¹Ÿæ²¡æœ‰è¾“å‡ºã€‚</a></li><li><a href=#é”-å¼‚æ­¥ç­‰åŒæ­¥èµ„æºåˆå§‹åŒ–é—®é¢˜>é”ï¼Ÿ å¼‚æ­¥ç­‰åŒæ­¥ï¼Ÿèµ„æºåˆå§‹åŒ–é—®é¢˜ï¼Ÿ</a></li><li><a href=#æ’æ›²>æ’æ›²</a></li></ol></li><li><a href=#å¼€å§‹é”å®šé—®é¢˜>å¼€å§‹é”å®šé—®é¢˜</a><ol><li><a href=#ä¸­é—´ä»¶å¯¼è‡´çš„å—>ä¸­é—´ä»¶å¯¼è‡´çš„å—ï¼Ÿ</a></li><li><a href=#è‡ªå®šä¹‰-filters-å¯¼è‡´çš„å—>è‡ªå®šä¹‰ filters å¯¼è‡´çš„å—ï¼Ÿ</a></li><li><a href=#å°è¯•ä½¿ç”¨-ptrace>å°è¯•ä½¿ç”¨ ptrace</a><ol><li><a href=#speedscopechromium>speedscope/chromium</a></li></ol></li><li><a href=#chrome-performance>Chrome Performance</a><ol><li><a href=#performwaitcallback>PerformWaitCallback</a></li><li><a href=#è°ƒç”¨é“¾ä¿¡æ¯>è°ƒç”¨é“¾ä¿¡æ¯</a></li></ol></li><li><a href=#è¿™æ˜¯ä¸€ä¸ª-èµ„æºé˜»å¡é—®é¢˜äº§ç”Ÿçš„é—®é¢˜>è¿™æ˜¯ä¸€ä¸ª â€œèµ„æºé˜»å¡é—®é¢˜â€äº§ç”Ÿçš„é—®é¢˜</a></li></ol></li><li><a href=#æ§åˆ¶å˜é‡å®è·µ>æ§åˆ¶å˜é‡å®è·µ</a><ol><li><a href=#æŒªæ¥å£ä»£ç >æŒªæ¥å£ä»£ç </a></li><li><a href=#account-balance-æœ‰ä»€ä¹ˆç¥å¥‡çš„ä¸œè¥¿å—>account-balance æœ‰ä»€ä¹ˆç¥å¥‡çš„ä¸œè¥¿å—ï¼Ÿ</a></li></ol></li><li><a href=#åŸæ¥æ˜¯-redis-çš„é”…>åŸæ¥æ˜¯ Redis çš„é”…ï¼Ÿ</a><ol><li><a href=#è¿˜æœ‰æ›´ä¼˜çš„å†™æ³•å—>è¿˜æœ‰æ›´ä¼˜çš„å†™æ³•å—ï¼Ÿ</a></li></ol></li><li><a href=#å¤ç›˜>å¤ç›˜</a></li><li><a href=#å‡ ä¸ªé€šç”¨çš„å°æŠ€å·§>å‡ ä¸ªé€šç”¨çš„å°æŠ€å·§</a></li><li><a href=#ç›¸å…³èµ„æ–™>ç›¸å…³èµ„æ–™</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/zh/p/%E4%B8%80%E6%AC%A1%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E4%B8%8D%E6%85%8E%E5%BC%95%E5%8F%91%E7%9A%84%E4%B8%80%E8%BF%9E%E4%B8%B2%E4%BA%8B%E6%95%85/>ä¸€æ¬¡ä¾èµ–æ³¨å…¥ä¸æ…å¼•å‘çš„ä¸€è¿ä¸²äº‹æ•…</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>6æœˆ 07, 2020</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>11 minute read</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://liguobao.github.io/p/a-di-misstep-that-cascaded-into-startup-incidents/ class=link>English</a></div></footer></div></header><section class=article-content><p>ä¸€æ¬¡ä¾èµ–æ³¨å…¥ä¸æ…å¼•å‘çš„ä¸€è¿ä¸²äº‹æ•…ã€‚</p><h2 id=èµ·å› å’Œç°è±¡>èµ·å› å’Œç°è±¡</h2><p>å¶å°”ä¼šçœ‹åˆ°çº¿ä¸ŠæœåŠ¡å¯åŠ¨çš„æ—¶å€™ç¬¬ä¸€æ³¢æµé‡è¿›æ¥ä¹‹åï¼Œ</p><p>è¿Ÿè¿Ÿæ²¡æœ‰ä»»ä½•çš„å“åº”ï¼ŒåŒæ—¶æœåŠ¡çš„ç›‘æ§æ£€æŸ¥æ¥å£æ­£å¸¸ï¼Œ</p><p>æ‰€ä»¥ K8S é›†ç¾¤è®¤ä¸ºæœåŠ¡æ­£å¸¸ï¼Œç»§ç»­æ”¾å…¥æµé‡ã€‚</p><p>æŸ¥çœ‹æ—¥å¿—åŸºæœ¬å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[2020-06-05T13:00:30.7080743+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test
</span></span><span class=line><span class=cl>[2020-06-05T13:00:30.7081525+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type
</span></span><span class=line><span class=cl>[2020-06-05T13:00:31.7074253+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id &#34;0HM09A1MAAR21&#34; started.
</span></span><span class=line><span class=cl>[2020-06-05T13:00:31.7077051+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance
</span></span><span class=line><span class=cl>[2020-06-05T13:00:31.7077942+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type
</span></span><span class=line><span class=cl>[2020-06-05T13:00:32.2103440+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id &#34;0HM09A1MAAR22&#34; started.
</span></span><span class=line><span class=cl>[2020-06-05T13:00:32.2118432+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance
</span></span><span class=line><span class=cl>[2020-06-05T13:00:32.2125894+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-ba&#39;lan&#39;ce does not match a supported file type
</span></span><span class=line><span class=cl>[2020-06-05T13:00:33.2223942+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id &#34;0HM09A1MAAR23&#34; started.
</span></span><span class=line><span class=cl>[2020-06-05T13:00:33.2238736+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance
</span></span><span class=line><span class=cl>[2020-06-05T13:00:33.2243808+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type
</span></span><span class=line><span class=cl>[2020-06-05T13:00:34.2177528+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id &#34;0HM09A1MAAR24&#34; started.
</span></span><span class=line><span class=cl>[2020-06-05T13:00:34.2189073+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance
</span></span><span class=line><span class=cl>[2020-06-05T13:00:34.2193483+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type
</span></span><span class=line><span class=cl>[2020-06-05T13:00:35.2169806+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id &#34;0HM09A1MAAR25&#34; started.
</span></span><span class=line><span class=cl>[2020-06-05T13:00:35.2178259+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance
</span></span><span class=line><span class=cl>[2020-06-05T13:00:35.2181055+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type
</span></span><span class=line><span class=cl>[2020-06-05T13:00:36.2183025+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id &#34;0HM09A1MAAR26&#34; started.
</span></span><span class=line><span class=cl>[2020-06-05T13:00:36.2195050+00:00 Microsoft.AspNetCore.Hosting.Diagnostics INF] Request starting HTTP/1.0 GET http://172.16.2.52/v1/user/test/account-balance
</span></span><span class=line><span class=cl>[2020-06-05T13:00:36.2199702+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG] The request path /v1/user/test/account-balance does not match a supported file type
</span></span><span class=line><span class=cl>[2020-06-05T13:00:37.2373822+00:00 Microsoft.AspNetCore.Server.Kestrel DBG] Connection id &#34;0HM09A1MAAR27&#34; started.
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=å¼•å‘çš„å‡ ç§åæœ>å¼•å‘çš„å‡ ç§åæœ</h3><h4 id=å®¢æˆ·ç«¯è°ƒç”¨è¶…æ—¶>å®¢æˆ·ç«¯è°ƒç”¨è¶…æ—¶</h4><p>ç»è¿‡äº† 30S ç”šè‡³æ›´é•¿æ—¶é—´åçœ‹åˆ°å¤§é‡çš„æ•°æ®åº“è¿æ¥è¢«åˆå§‹åŒ–ï¼Œç„¶åå¼€å§‹é›†ä¸­å¼è¿”å›ã€‚</p><p>æ­¤æ—¶å¯èƒ½å¯¹äºå®¢æˆ·ç«¯è°ƒç”¨æ¥è¯´è¿™ä¸€æ‰¹è¯·æ±‚éƒ½æ˜¯è¶…æ—¶çš„ï¼Œ</p><p>ä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒå’ŒæŸäº›ä¾èµ–äºæ­¤çš„å…¶ä»–æ¥å£ã€‚</p><h4 id=æ•°æ®åº“è¿æ¥æš´æ¶¨>æ•°æ®åº“è¿æ¥æš´æ¶¨</h4><p>å› ä¸ºåŒæ—¶è¿›å…¥å¤§é‡æ•°æ®åº“æŸ¥è¯¢è¯·æ±‚è§¦å‘æ•°æ®åº“ DbContextPool å¤§é‡åˆ›å»ºï¼Œ</p><p>è¿æ¥æ•°éšä¹‹æš´æ¶¨ï¼Œæ•°æ®åº“æŸ¥è¯¢æ€§èƒ½æ€¥é€Ÿä¸‹é™ï¼Œå¯èƒ½å¼•å‘å…¶ä»–çš„åº”ç”¨é—®é¢˜ã€‚</p><h4 id=å¼•å‘æœåŠ¡é›ªå´©æ•ˆåº”æœåŠ¡ä¸å¯ç”¨>å¼•å‘æœåŠ¡â€œé›ªå´©â€æ•ˆåº”ï¼ŒæœåŠ¡ä¸å¯ç”¨</h4><p>è¯·æ±‚å †ç§¯çš„æƒ…å†µä¸‹ï¼Œ</p><p>health-check æ¥å£å“åº”å¼‚å¸¸ï¼Œ</p><p>å¯¼è‡´ k8s ä¸»åŠ¨é‡å¯æœåŠ¡ï¼Œé‡å¯åç»§ç»­ä¸Šè¿°æƒ…å†µï¼Œ</p><p>ä¸æ–­æ¶åŒ–æœ€åå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚</p><hr><h2 id=æ’æŸ¥é—®é¢˜>æ’æŸ¥é—®é¢˜</h2><h3 id=æ•°æ®åº“çš„é—®é¢˜->æ•°æ®åº“çš„é—®é¢˜ ï¼Ÿ</h3><p>å½“ç„¶ï¼Œé¦–å…ˆæ€€ç–‘çš„å°±æ˜¯æ•°æ®åº“äº†ã€‚</p><p>å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Ÿæ…¢æŸ¥è¯¢å¯¼è‡´ä¸å“åº”ï¼Ÿå‘å¸ƒæœŸé—´å­˜åœ¨å…¶ä»–çš„å¼‚å¸¸ï¼Ÿ</p><p>è¿™ç±»çš„é—®é¢˜éƒ½æ„ä¹‰æ’æŸ¥èµ·æ¥äº†ã€‚</p><p>æœ€åå‘ç°ï¼Œ</p><p>è¿™ç§æƒ…å†µå‘ç”Ÿçš„æ—¶å€™ï¼Œæ•°æ®åº“ç›‘æ§é‡Œé¢ä¸€ç‰‡ç¥¥å’Œã€‚</p><p>æ•°æ®åº“ IOã€CPUã€å†…å­˜éƒ½æ­£å¸¸ï¼Œ</p><p>è¿æ¥æ•°æš´æ¶¨æ˜¯è¿™ç§æƒ…å†µå‘ç”Ÿçš„æ—¶å€™å¸¦æ¥çš„ï¼Œ</p><p>è€Œä¸æ˜¯è¿æ¥æ•°æš´æ¶¨ä¹‹åå¯¼è‡´äº†æ­¤æƒ…å†µã€‚</p><h3 id=æ•°æ®åº“é©±åŠ¨æˆ–è€…-ef-core-æ¡†æ¶çš„é—®é¢˜>æ•°æ®åº“é©±åŠ¨æˆ–è€… EF Core æ¡†æ¶çš„é—®é¢˜ï¼Ÿ</h3><p>æ˜¯çš„ï¼Œ</p><p>è¿™ä¸ªæ€€ç–‘ä¸€ç›´éƒ½å­˜åœ¨äºè„‘æµ·ä¸­ã€‚</p><p>æœ€ç»ˆï¼Œ</p><p>æ˜¨å¤©å¸¦ç€â€œè¢«æŒ¨éª‚çš„æƒ…å†µâ€å»é—®äº†ä¸‹â€œPomelo.EntityFrameworkCore.MySqlâ€çš„ä½œè€…ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ˜¥å¤©çš„ç†Š 18:34:08
</span></span><span class=line><span class=cl>æŸšå­å•Šï¼Œæˆ‘è¿™è¾¹çš„.NET CoreæœåŠ¡åˆšèµ·æ¥ï¼Œå»ºç«‹MySQLè¿æ¥çš„æ—¶å€™å¥½æ…¢ï¼Œç„¶ååŒä¸€æ‰¹è¯·æ±‚å¯èƒ½æ— æ³•æ­£å¸¸å“åº”ï¼Œè¿™ä¸ªæœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ€è·¯å—ï¼Ÿ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:34:29
</span></span><span class=line><span class=cl>Min Pool Size = 200
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:34:32
</span></span><span class=line><span class=cl>æ”¾è¿æ¥å­—ç¬¦ä¸²é‡Œ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ˜¥å¤©çš„ç†Š 18:34:53
</span></span><span class=line><span class=cl>è¿™ä¸ªå­—æ®µæ”¯æŒäº†å—ï¼Ÿ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:35:07
</span></span><span class=line><span class=cl>ä¸€ç›´éƒ½æ”¯æŒ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ˜¥å¤©çš„ç†Š 18:35:56
</span></span><span class=line><span class=cl>ç­‰ç­‰ï¼Œ      public static IServiceCollection AddDbContextPool&lt;TContext&gt;([NotNullAttribute] this IServiceCollection serviceCollection, [NotNullAttribute] Action&lt;DbContextOptionsBuilder&gt; optionsAction, int poolSize = 128) where TContext : DbContext;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ˜¥å¤©çš„ç†Š 18:36:13
</span></span><span class=line><span class=cl>è¿™é‡Œä¸æ˜¯é»˜è®¤æœ€å¤§çš„128ä¹ˆï¼Ÿ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:36:18
</span></span><span class=line><span class=cl>ä½ è¿™ä¸ªpool sizeæ˜¯dbcontextçš„
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:36:21
</span></span><span class=line><span class=cl>æˆ‘è¯´çš„æ˜¯mysqlè¿æ¥å­—ç¬¦ä¸²çš„
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:36:28
</span></span><span class=line><span class=cl>dbcontextçš„poolæœ‰ä»€ä¹ˆç”¨
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ˜¥å¤©çš„ç†Š 18:43:13
</span></span><span class=line><span class=cl>æˆ‘é—®ä¸ªè®¨æ‰“çš„é—®é¢˜ï¼Œdbcontext æ˜¯å…·ä½“çš„é“¾æ¥å®ä¾‹ï¼ŒEFç”¨çš„ï¼ŒMin Pool Size æŒ‡çš„æ˜¯è¿™ä¸€ä¸ªå®ä¾‹ä¸Šé¢çš„è¿æ¥æ± å—â€œï¼Ÿ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:44:07
</span></span><span class=line><span class=cl>ä½ åœ¨è¯´ä»€ä¹ˆã€‚ã€‚ã€‚
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:45:58
</span></span><span class=line><span class=cl>æ”¾åˆ°mysqlçš„è¿æ¥å­—ç¬¦ä¸²ä¸Š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:46:14
</span></span><span class=line><span class=cl>è¿™æ ·ç¬¬ä¸€æ¬¡è°ƒç”¨MySqlConnectionçš„æ—¶å€™å°±ä¼šå»ºç«‹200ä¸ªè¿æ¥
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ˜¥å¤©çš„ç†Š 18:46:56
</span></span><span class=line><span class=cl>é»˜è®¤æ˜¯å¤šå°‘æ¥çš„ï¼Ÿ100å—ï¼Ÿ
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:48:33
</span></span><span class=line><span class=cl>0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:48:40
</span></span><span class=line><span class=cl>maxé»˜è®¤æ˜¯100
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:52:50
</span></span><span class=line><span class=cl>DbContextPoolè¦è§£å†³çš„é—®é¢˜ä½ éƒ½æ²¡ææ¸…æ¥š
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ˜¥å¤©çš„ç†Š 18:53:23
</span></span><span class=line><span class=cl>DbContextPoolè¦è§£å†³çš„æ˜¯å°½é‡ä¸å»é‡å¤åˆ›å»ºDbContext
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:53:34
</span></span><span class=line><span class=cl>ä¸ºä»€ä¹ˆä¸è¦é‡å¤åˆ›å»ºDbContext
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>æ˜¥å¤©çš„ç†Š 18:53:50
</span></span><span class=line><span class=cl>å› ä¸ºæ¯ä¸ªDbContextåˆ›å»ºçš„ä»£ä»·å¾ˆé«˜ï¼Œè€Œä¸”å¾ˆæ…¢
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:54:01
</span></span><span class=line><span class=cl>åˆ›å»ºDbContextæœ‰ä»€ä¹ˆä»£ä»·
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:54:03
</span></span><span class=line><span class=cl>å“ªé‡Œæ…¢äº†
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:54:06
</span></span><span class=line><span class=cl>éƒ½æ˜¯æ¯«ç§’çº§çš„
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:54:20
</span></span><span class=line><span class=cl>ä»–çš„ä»£ä»·ä¸åœ¨äºåˆ›å»º è€Œåœ¨äºå›æ”¶
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Yukoä¸¶æŸšå­ 18:54:25
</span></span><span class=line><span class=cl>DbContextPoolè¦è§£å†³çš„é—®é¢˜æ˜¯ å› ä¸ºDbContextå±äºè¾ƒå¤§çš„å¯¹è±¡ï¼Œè€Œä¸”æ˜¯é¢‘ç¹è¢«newï¼Œè€Œä¸”ç»å¸¸å¤±å»å¼•ç”¨å¯¼è‡´GCé¢‘ç¹å·¥ä½œã€‚
</span></span></code></pre></td></tr></table></div></div><p>Yuko å¤§å¤§è¯´çš„æƒ…å†µæ„Ÿè§‰ä¼šæ˜¯ä¸€ä¸ªæ€è·¯ï¼Œ</p><p>æ‰€ä»¥ç¬¬ä¸€ååº”å°±æ˜¯åŠ äº†å‚æ•°æ§åˆ¶è¿æ¥æ± ã€‚</p><p>ä¸è¿‡ï¼Œæ— æœã€‚</p><p>5 ä¸ªå®ä¾‹ï¼Œ</p><p>æœ‰ 3 ä¸ªå®ä¾‹æ­£å¸¸å¯åŠ¨ï¼Œ</p><p>2 ä¸ªå®ä¾‹ä¼šé‡å¤â€œé›ªå´©â€æ•ˆåº”ï¼Œæœ€ç»ˆæ— æ³•æ­£å¸¸å¯åŠ¨ã€‚</p><p>è¿™ä¸ªå°è¯•æ“ä½œé‡å¤äº†å¥½å¤šæ¬¡ï¼Œ</p><p>æ ¹æ®æ–‡æ¡£å’Œ Yuko å¤§å¤§æŒ‡å¯¼ç»§ç»­åŠ äº†ä¸å°‘ MySQL é“¾æ¥å‚æ•°ï¼Œ</p><p>æœ€åï¼Œ</p><p>é‡æ–°å­¦ä¹ äº†ä¸€æ³¢é“¾æ¥å‚æ•°çš„ä¼˜åŒ–æ„ä¹‰ï¼Œ</p><p>æ— æœã€‚</p><hr><h3 id=ç©¶ç«Ÿæ•°æ®åº“é©±åŠ¨æœ‰æ²¡æœ‰é—®é¢˜>ç©¶ç«Ÿæ•°æ®åº“é©±åŠ¨æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿ</h3><p>æ²¡ä»€ä¹ˆå¥½çš„æ€è·¯äº†ï¼Œ</p><p>è¿œç¨‹åˆ°å®¹å™¨é‡Œé¢ Debug åŸºæœ¬ä¸å¤ªç°å®ï¼ˆé‡æ–°æ‰“åŒ… + å®¹å™¨åŒ–æ‰“åŒ… + k8s + äººè‚‰å’ŒæœåŠ¡å™¨å®å¤§æ´‹ï¼‰ï¼Œ</p><p>è¦ä¸ï¼Œè¯•è¯•æŠŠæ—¥å¿—ç™»å½•è°ƒèŠ‚åˆ° Debug çœ‹çœ‹æ‰€æœ‰çš„è¡Œä¸ºï¼Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Using&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;Serilog.Sinks.Console&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;MinimumLevel&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Default&#34;</span><span class=p>:</span> <span class=s2>&#34;Debug&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Override&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Microsoft&#34;</span><span class=p>:</span> <span class=s2>&#34;Debug&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;WriteTo&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Name&#34;</span><span class=p>:</span> <span class=s2>&#34;Console&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;Args&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;outputTemplate&#34;</span><span class=p>:</span> <span class=s2>&#34;[{Timestamp:o}  {SourceContext} {Level:u3}] {Message:lj}{NewLine}{Exception}&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å½“ç„¶ï¼Œè¿™ä¸ªäº‹æƒ…æ²¡æœ‰ç›´æ¥åœ¨æ­£å¸¸çš„ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œã€‚</p><p>è¿™é‡Œæ˜¯ä½¿ç”¨æ–°é…ç½®ï¼Œé‡æ–°èµ·æ–°å®ä¾‹æ¥æ“ä½œã€‚</p><p>ç„¶åæˆ‘ä»¬çœ‹åˆ°ç¨‹åºå¯åŠ¨çš„æ—¶å€™æ‰§è¡Œ EFMigration çš„æ—¶å€™ï¼Œ</p><p>ç¨‹åºå’Œæ•´ä¸ªæ•°æ®åº“äº¤äº’çš„å®Œæ•´æ—¥å¿—ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4147202</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Connection</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Opening</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=s1>&#39;user_pool&#39;</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>server</span><span class=w> </span><span class=s1>&#39;aliyun-rds&#39;</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4159970</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Connection</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Opened</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=s1>&#39;user_pool&#39;</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>server</span><span class=w> </span><span class=s1>&#39;a&#39;</span><span class=n>li</span><span class=s1>&#39;yun&#39;</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4161172</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Command</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Executing</span><span class=w> </span><span class=n>DbCommand</span><span class=w> </span><span class=p>[</span><span class=n>Parameters</span><span class=o>=</span><span class=p>[],</span><span class=w> </span><span class=n>CommandType</span><span class=o>=</span><span class=s1>&#39;Text&#39;</span><span class=p>,</span><span class=w> </span><span class=n>CommandTimeout</span><span class=o>=</span><span class=s1>&#39;30&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>INFORMATION_SCHEMA</span><span class=p>.</span><span class=kp>TABLES</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>TABLE_SCHEMA</span><span class=o>=</span><span class=s1>&#39;user_pool&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>TABLE_NAME</span><span class=o>=</span><span class=s1>&#39;__EFMigrationsHistory&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4170776</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Command</span><span class=w> </span><span class=n>INF</span><span class=p>]</span><span class=w> </span><span class=n>Executed</span><span class=w> </span><span class=nf>DbCommand</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=n>ms</span><span class=p>)</span><span class=w> </span><span class=p>[</span><span class=n>Parameters</span><span class=o>=</span><span class=p>[],</span><span class=w> </span><span class=n>CommandType</span><span class=o>=</span><span class=s1>&#39;Text&#39;</span><span class=p>,</span><span class=w> </span><span class=n>CommandTimeout</span><span class=o>=</span><span class=s1>&#39;30&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>INFORMATION_SCHEMA</span><span class=p>.</span><span class=kp>TABLES</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>TABLE_SCHEMA</span><span class=o>=</span><span class=s1>&#39;user_pool&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>TABLE_NAME</span><span class=o>=</span><span class=s1>&#39;__EFMigrationsHistory&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4171630</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Connection</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Closing</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=s1>&#39;user_pool&#39;</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>server</span><span class=w> </span><span class=s1>&#39;aliyun-rds&#39;</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4172458</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Connection</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Closed</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=s1>&#39;user_pool&#39;</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>server</span><span class=w> </span><span class=s1>&#39;aliyun-rds&#39;</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4385345</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Command</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Creating</span><span class=w> </span><span class=n>DbCommand</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=s1>&#39;ExecuteReader&#39;</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4386201</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Command</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Created</span><span class=w> </span><span class=n>DbCommand</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=s1>&#39;ExecuteReader&#39;</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=n>ms</span><span class=p>).</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4386763</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Connection</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Opening</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=s1>&#39;user_pool&#39;</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>server</span><span class=w> </span><span class=s1>&#39;aliyun-rds&#39;</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4400143</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Connection</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Opened</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=s1>&#39;user_pool&#39;</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>server</span><span class=w> </span><span class=s1>&#39;aliyun-rds&#39;</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4404529</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Command</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Executing</span><span class=w> </span><span class=n>DbCommand</span><span class=w> </span><span class=p>[</span><span class=n>Parameters</span><span class=o>=</span><span class=p>[],</span><span class=w> </span><span class=n>CommandType</span><span class=o>=</span><span class=s1>&#39;Text&#39;</span><span class=p>,</span><span class=w> </span><span class=n>CommandTimeout</span><span class=o>=</span><span class=s1>&#39;30&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>`</span><span class=n>MigrationId</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>ProductVersion</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>FROM</span><span class=w> </span><span class=o>`</span><span class=n>__EFMigrationsHistory</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=o>`</span><span class=n>MigrationId</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4422387</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Command</span><span class=w> </span><span class=n>INF</span><span class=p>]</span><span class=w> </span><span class=n>Executed</span><span class=w> </span><span class=nf>DbCommand</span><span class=w> </span><span class=p>(</span><span class=mi>2</span><span class=n>ms</span><span class=p>)</span><span class=w> </span><span class=p>[</span><span class=n>Parameters</span><span class=o>=</span><span class=p>[],</span><span class=w> </span><span class=n>CommandType</span><span class=o>=</span><span class=s1>&#39;Text&#39;</span><span class=p>,</span><span class=w> </span><span class=n>CommandTimeout</span><span class=o>=</span><span class=s1>&#39;30&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>`</span><span class=n>MigrationId</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>ProductVersion</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>FROM</span><span class=w> </span><span class=o>`</span><span class=n>__EFMigrationsHistory</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=o>`</span><span class=n>MigrationId</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4446400</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Command</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=n>reader</span><span class=w> </span><span class=n>was</span><span class=w> </span><span class=n>disposed</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4447422</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Connection</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Closing</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=s1>&#39;user_pool&#39;</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>server</span><span class=w> </span><span class=s1>&#39;aliyun-rds&#39;</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>4447975</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=k>Database</span><span class=p>.</span><span class=n>Connection</span><span class=w> </span><span class=n>DBG</span><span class=p>]</span><span class=w> </span><span class=n>Closed</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=s1>&#39;user_pool&#39;</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>server</span><span class=w> </span><span class=s1>&#39;aliyun-rds&#39;</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>2020</span><span class=o>-</span><span class=mi>06</span><span class=o>-</span><span class=mi>05</span><span class=n>T12</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>56</span><span class=p>.</span><span class=mi>5170419</span><span class=o>+</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>EntityFrameworkCore</span><span class=p>.</span><span class=n>Migrations</span><span class=w> </span><span class=n>INF</span><span class=p>]</span><span class=w> </span><span class=n>No</span><span class=w> </span><span class=n>migrations</span><span class=w> </span><span class=n>were</span><span class=w> </span><span class=n>applied</span><span class=p>.</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=k>database</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>already</span><span class=w> </span><span class=n>up</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=kt>date</span><span class=p>.</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><p>çœ‹åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œç”±äºå‘ç°æˆ‘ä»¬ä¹‹å‰å¯¹ DbContext å’Œ DbConnection çš„ç†è§£ä¸å¤ªå¥½ï¼Œ</p><p>æƒ³ææ¸…æ¥šç©¶ç«Ÿæ˜¯ä¸ db connection åˆ›å»ºçš„æ—¶å€™æœ‰å“ªäº›è¡Œä¸ºï¼Œ</p><p>äºæ˜¯æˆ‘ä»¬æ‰¾åˆ°äº† <a class=link href=https://github.com/dotnet/efcore target=_blank rel=noopener>dotnet/efcore Github </a>çš„æºç å¼€å§‹æ‹œè¯»ï¼Œ</p><p>PSï¼š æºç çœŸé¦™ï¼Œèƒ½çœ‹æºç çœŸå¥½ã€‚</p><p>å°è¯•é€šè¿‡â€œOpening connectionâ€æ‰¾åˆ°æ—¥å¿—çš„åœºæ™¯ã€‚</p><p>æƒ³äº†è§£è¿™ä¸ªæ—¥å¿—è¾“å‡ºçš„æ—¶å€™ä»£ç åœ¨åšä»€ä¹ˆæ ·çš„äº‹æƒ…ï¼Œå¯èƒ½åŒæ—¶ä¼šæœ‰å“ªäº›è¡Œä¸ºã€‚</p><p>åœ¨è€ƒè™‘æ˜¯ä¸æ˜¯å…¶ä»–çš„ä¸€äº›è¡Œä¸ºå¯¼è‡´äº†ä¸Šé¢çš„æœåŠ¡é—®é¢˜ï¼Ÿ</p><p>æœ€ç»ˆåœ¨<a class=link href=https://github.com/dotnet/efcore/blob/14f13ef6dfb0aae7e2faedfb0de604070fc5d101/src/EFCore.Relational/Storage/RelationalConnection.cs target=_blank rel=noopener>RelationalConnection.cs</a>ç¡®è®¤ä¸Šé¢è¿™äº›æ•°æ®åº“ç›¸å…³æ—¥å¿—è‚¯å®šæ˜¯ä¼šè¾“å‡ºçš„ï¼Œä¸å­˜åœ¨å…¶ä»–çš„å¼‚å¸¸è¡Œä¸ºã€‚</p><p>PSï¼šä¸ç”¨ç»†çœ‹ï¼Œæˆ‘ä»¬è®¤çœŸæµè§ˆäº†ä»£ç ä¹‹åç¡®è®¤ DbContext æ­£å¸¸åˆå§‹åŒ–ï¼Œ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>///     Asynchronously opens the connection to the database.</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;param name=&#34;errorsExpected&#34;&gt; Indicate if the connection errors are expected and should be logged as debug message. &lt;/param&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;param name=&#34;cancellationToken&#34;&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>///     A &lt;see cref=&#34;CancellationToken&#34; /&gt; to observe while waiting for the task to complete.</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/param&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;returns&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>///     A task that represents the asynchronous operation, with a value of &lt;see langword=&#34;true&#34;/&gt; if the connection</span>
</span></span><span class=line><span class=cl>        <span class=cs>///     was actually opened.</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/returns&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=k>virtual</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=kt>bool</span><span class=p>&gt;</span> <span class=n>OpenAsync</span><span class=p>(</span><span class=n>CancellationToken</span> <span class=n>cancellationToken</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>errorsExpected</span> <span class=p>=</span> <span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>DbConnection</span><span class=p>.</span><span class=n>State</span> <span class=p>==</span> <span class=n>ConnectionState</span><span class=p>.</span><span class=n>Broken</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>DbConnection</span><span class=p>.</span><span class=n>CloseAsync</span><span class=p>().</span><span class=n>ConfigureAwait</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>wasOpened</span> <span class=p>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>DbConnection</span><span class=p>.</span><span class=n>State</span> <span class=p>!=</span> <span class=n>ConnectionState</span><span class=p>.</span><span class=n>Open</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>CurrentTransaction</span> <span class=p>!=</span> <span class=kc>null</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>CurrentTransaction</span><span class=p>.</span><span class=n>DisposeAsync</span><span class=p>().</span><span class=n>ConfigureAwait</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>ClearTransactions</span><span class=p>(</span><span class=n>clearAmbient</span><span class=p>:</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>OpenDbConnectionAsync</span><span class=p>(</span><span class=n>errorsExpected</span><span class=p>,</span> <span class=n>cancellationToken</span><span class=p>).</span><span class=n>ConfigureAwait</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>wasOpened</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>_openedCount</span><span class=p>++;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>HandleAmbientTransactions</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>wasOpened</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>OpenDbConnectionAsync</span><span class=p>(</span><span class=kt>bool</span> <span class=n>errorsExpected</span><span class=p>,</span> <span class=n>CancellationToken</span> <span class=n>cancellationToken</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>startTime</span> <span class=p>=</span> <span class=n>DateTimeOffset</span><span class=p>.</span><span class=n>UtcNow</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>stopwatch</span> <span class=p>=</span> <span class=n>Stopwatch</span><span class=p>.</span><span class=n>StartNew</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// æ—¥å¿—è¾“å‡ºåœ¨è¿™é‡Œ</span>
</span></span><span class=line><span class=cl>            <span class=kt>var</span> <span class=n>interceptionResult</span>
</span></span><span class=line><span class=cl>                <span class=p>=</span> <span class=k>await</span> <span class=n>Dependencies</span><span class=p>.</span><span class=n>ConnectionLogger</span><span class=p>.</span><span class=n>ConnectionOpeningAsync</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>startTime</span><span class=p>,</span> <span class=n>cancellationToken</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>.</span><span class=n>ConfigureAwait</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>try</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(!</span><span class=n>interceptionResult</span><span class=p>.</span><span class=n>IsSuppressed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>await</span> <span class=n>DbConnection</span><span class=p>.</span><span class=n>OpenAsync</span><span class=p>(</span><span class=n>cancellationToken</span><span class=p>).</span><span class=n>ConfigureAwait</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=c1>// æ—¥å¿—è¾“å‡ºåœ¨è¿™é‡Œ</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>Dependencies</span><span class=p>.</span><span class=n>ConnectionLogger</span><span class=p>.</span><span class=n>ConnectionOpenedAsync</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>startTime</span><span class=p>,</span> <span class=n>stopwatch</span><span class=p>.</span><span class=n>Elapsed</span><span class=p>,</span> <span class=n>cancellationToken</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>.</span><span class=n>ConfigureAwait</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>await</span> <span class=n>Dependencies</span><span class=p>.</span><span class=n>ConnectionLogger</span><span class=p>.</span><span class=n>ConnectionErrorAsync</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=k>this</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>e</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>startTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>stopwatch</span><span class=p>.</span><span class=n>Elapsed</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>errorsExpected</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>cancellationToken</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>.</span><span class=n>ConfigureAwait</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>throw</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>_openedCount</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>_openedInternally</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å½“ç„¶ï¼Œæˆ‘ä»¬åŒæ—¶ä¹Ÿå»çœ‹äº†ä¸€çœ¼ <a class=link href=https://mysqlconnector.net/ target=_blank rel=noopener>MySqlConnector</a>çš„æºç ï¼Œ</p><p>ç¡®è®¤å®ƒè‡ªèº«æ˜¯ç»´æŠ¤äº†æ•°æ®åº“è¿æ¥æ± çš„ã€‚åˆ°è¿™é‡ŒåŸºæœ¬ç¡®è®¤ä¸ä¼šæ˜¯æ•°æ®åº“é©±åŠ¨å¯¼è‡´çš„ä¸Šè¿°é—®é¢˜ã€‚</p><hr><h2 id=æŸç§çŒœæµ‹>æŸç§çŒœæµ‹</h2><h3 id=è‚¯å®šæ˜¯æœ‰ä»€ä¹ˆå¥‡æ€ªçš„è¡Œä¸ºé˜»å¡äº†å½“å‰æœåŠ¡è¿›ç¨‹>è‚¯å®šæ˜¯æœ‰ä»€ä¹ˆå¥‡æ€ªçš„è¡Œä¸ºé˜»å¡äº†å½“å‰æœåŠ¡è¿›ç¨‹ï¼Œ</h3><h3 id=å¯¼è‡´æ•°æ®åº“è¿æ¥çš„æ—¥å¿—ä¹Ÿæ²¡æœ‰è¾“å‡º>å¯¼è‡´æ•°æ®åº“è¿æ¥çš„æ—¥å¿—ä¹Ÿæ²¡æœ‰è¾“å‡ºã€‚</h3><h3 id=é”-å¼‚æ­¥ç­‰åŒæ­¥èµ„æºåˆå§‹åŒ–é—®é¢˜>é”ï¼Ÿ å¼‚æ­¥ç­‰åŒæ­¥ï¼Ÿèµ„æºåˆå§‹åŒ–é—®é¢˜ï¼Ÿ</h3><p>å‘¨äº”æ™šä¸ŠæŸ¥åˆ°äº†è¿™é‡Œå·²ç»åä¸€ç‚¹äº†ï¼Œ</p><p>äºæ˜¯å…ˆä¸‹ç­å›å®¶ä¼‘æ¯äº†ã€‚</p><p>äºæ˜¯ï¼Œ</p><p>å‘¨å…­ç»ƒå®Œè½¦ä¹‹å Call äº†ä¸€ä¸‹å°ä¼™ä¼´ï¼Œ</p><p>åˆåŒåŒå¼€å§‹äº†æ„‰å¿«çš„ Debugã€‚</p><hr><h3 id=æ’æ›²>æ’æ›²</h3><p>å°ä¼™ä¼´æµ·æ—å›å…¬å¸å‰å‘äº†ä¸ªæœ‹å‹åœˆã€‚</p><p>â€œ å’‹ä»¬ç»§ç»­æ˜¨å¤©çš„ bugï¼Œ</p><p>ç‰¹æ­¤ç«‹ flagï¼šä¿®ä¸å¥½ç›´æ’­åƒ bug</p><p>åæ­£ä¸æ˜¯ä½ æ­»å°±æ˜¯æˆ‘äº¡â€¦â€</p><p>æˆ‘è°ƒä¾ƒè¯„è®ºè¯´:</p><p>ä½ ç­‰ä¸‹ï¼Œæˆ‘æ‰“åŒ…ä¸‹ä»£ç å»æ¥¼ä¸‹æ‰“å°å‡ºæ¥å¾…ä¼šå½“æ™šé¥­</p><hr><h2 id=å¼€å§‹é”å®šé—®é¢˜>å¼€å§‹é”å®šé—®é¢˜</h2><h3 id=ä¸­é—´ä»¶å¯¼è‡´çš„å—>ä¸­é—´ä»¶å¯¼è‡´çš„å—ï¼Ÿ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[2020-06-05T13:00:35.2181055+00:00 Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware DBG]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The request path /v1/user/test/account-balance does not match a supported file type
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬å¯¹ç€è¿™ä¸ªæ—¥å¿—æ€è€ƒäº†ä¸€ä¼šäººç”Ÿï¼Œ</p><p>ç„¶åæŠŠå¼•ç”¨æ­¤ä¸­é—´ä»¶çš„ä»£ç æ³¨é‡Šæ‰äº†ï¼Œ</p><p>ä¸è¿‡ï¼Œæ— æœã€‚</p><h3 id=è‡ªå®šä¹‰-filters-å¯¼è‡´çš„å—>è‡ªå®šä¹‰ filters å¯¼è‡´çš„å—ï¼Ÿ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[2020-06-05T13:01:05.3126001+00:00 Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker DBG] Execution plan of exception filters (in the following order): [&#34;None&#34;]
</span></span><span class=line><span class=cl>[2020-06-05T13:01:05.3126391+00:00 Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker DBG] Execution plan of result filters (in the following order): [&#34;Microsoft.AspNetCore.Mvc.ViewFeatures.Filters.SaveTempDataFilter&#34;, &#34;XXX.Filters.HTTPHeaderAttribute (Order: 0)&#34;]
</span></span><span class=line><span class=cl>[2020-06-05T13:01:05.3072206+00:00 Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker DBG] Execution plan of authorization filters (in the following order): [&#34;None&#34;]
</span></span></code></pre></td></tr></table></div></div><p>çœ‹åˆ°è¿™ä¸ªæ—¥å¿—æˆ‘ä»¬è€ƒè™‘äº†ä¸€ä¸‹ï¼Œ</p><p>æ˜¯ä¸æ˜¯å› ä¸º filters å¯¼è‡´äº†é—®é¢˜ã€‚</p><p>æ¯•ç«Ÿåœ¨ HTTPHeaderAttribute æˆ‘ä»¬è¿˜è¿˜åšäº† ThreadLocal&lt;Dictionary&lt;string, string&#187; CurrentXHeaders</p><p>è¿™é‡Œæ€€ç–‘æ˜¯ä¸æ˜¯æˆ‘ä»¬çš„å®ç°å­˜åœ¨é”æœºåˆ¶å¯¼è‡´â€œå‡æ­»é—®é¢˜â€ã€‚</p><p>å°è¯•å»æ‰ã€‚</p><p>ä¸è¿‡ï¼Œ</p><p>æ— æœã€‚</p><hr><h3 id=å°è¯•ä½¿ç”¨-ptrace>å°è¯•ä½¿ç”¨ ptrace</h3><p>æ²¡ä»€ä¹ˆå¾ˆå¥½çš„å¤´ç»ªäº†ï¼Œè¦ä¸ä¸Šä¸€ä¸‹ ptrace ä¹‹ç±»çš„å·¥å…·è·Ÿä¸€ä¸‹ç³»ç»Ÿè°ƒç”¨ï¼Ÿ</p><p>æœ€æ—©åœ¨å»å¹´å°±å°è¯•è¿‡ä½¿ç”¨ ptrace æŠ“è¿›ç¨‹æ•°æ®çœ‹ç³»ç»Ÿè°ƒç”¨ï¼Œ</p><p>åæ¥å‡çº§åˆ°.NET Core3.0 ä¹‹åï¼Œå®˜æ–¹åŸºäº Events + LTTng ä¹‹ç±»çš„ä¸œè¥¿åšäº† dotnet-trace å·¥å…·ï¼Œ</p><p>å®˜ç½‘è¯´æ˜ï¼š<a class=link href=https://docs.microsoft.com/en-us/dotnet/core/diagnostics/dotnet-trace target=_blank rel=noopener>dotnet-trace performance analysis utility</a></p><p>æ”¹ä¸€ä¸‹æ‰“åŒ…æ‰”ä¸Šå»åšä¸€ä¸ªæ•°æ®æ”¶é›†çœ‹çœ‹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Docker data-lang=Docker><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>FROM</span><span class=w> </span><span class=s>mcr.microsoft.com/dotnet/core/sdk:3.1</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>build-env</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=c># copy csproj and restore as distinct layers</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>COPY</span> src/*.csproj ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet restore<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>COPY</span> . ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=c># copy everything else and build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet publish src -c Release -o /app/out<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=c># build runtime image</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>FROM</span><span class=w> </span><span class=s>mcr.microsoft.com/dotnet/core/aspnet:3.1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=c># debug</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=c># Install .NET Core SDK</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>RUN</span> <span class=nv>dotnet_sdk_version</span><span class=o>=</span>3.1.100 <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> curl -SL --output dotnet.tar.gz https://dotnetcli.azureedge.net/dotnet/Sdk/<span class=nv>$dotnet_sdk_version</span>/dotnet-sdk-<span class=nv>$dotnet_sdk_version</span>-linux-x64.tar.gz <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nv>dotnet_sha512</span><span class=o>=</span><span class=s1>&#39;5217ae1441089a71103694be8dd5bb3437680f00e263ad28317665d819a92338a27466e7d7a2b1f6b74367dd314128db345fa8fff6e90d0c966dea7a9a43bd21&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$dotnet_sha512</span><span class=s2> dotnet.tar.gz&#34;</span> <span class=p>|</span> sha512sum -c - <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> rm -rf /usr/share/dotnet <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> rm -rf /usr/bin/dotnet <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> mkdir -p /usr/share/dotnet <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> tar -ozxf dotnet.tar.gz -C /usr/share/dotnet <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> rm dotnet.tar.gz <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> ln -s /usr/share/dotnet/dotnet /usr/bin/dotnet <span class=se>\
</span></span></span><span class=line><span class=cl>    <span class=c1># Trigger first run experience by running arbitrary cmd</span><span class=err>
</span></span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> dotnet help<span class=err>
</span></span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet tool install --global dotnet-trace<span class=err>
</span></span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet tool install -g dotnet-dump<span class=err>
</span></span></span><span class=line><span class=cl><span class=k>RUN</span> dotnet tool install --global dotnet-counters<span class=err>
</span></span></span><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>PATH</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$PATH</span><span class=s2>:/root/.dotnet/tools&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=c># end debug</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>COPY</span> --from<span class=o>=</span>build-env /app/out .<span class=err>
</span></span></span><span class=line><span class=cl><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;dotnet&#34;</span><span class=p>,</span> <span class=s2>&#34;Your-APP.dll&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><hr><p>æ›´æ–°å‘å¸ƒï¼Œç­‰å¾…æœåŠ¡æ­£å¸¸å¯åŠ¨ä¹‹åï¼Œ</p><p>ä½¿ç”¨ ab -c 300 -n 3000 &lsquo;http://172.16.2.52/v1/user/test/account-balance&rsquo; æ¨¡æ‹Ÿ 300 ä¸ªç”¨æˆ·åŒæ—¶è¯·æ±‚ï¼Œ</p><p>ä½¿å¾—ç¨‹åºè¿›å…¥ä¸Šè¿°çš„â€œå‡æ­»çŠ¶æ€â€ã€‚</p><p>æ¥ç€ç«‹å³è¿›å…¥å®¹å™¨ï¼Œæ‰§è¡Œ&rsquo;dotnet-trace collect -p 1&rsquo; å¼€å§‹æ”¶é›†æ—¥å¿—ã€‚</p><p>æœ€åæ‹¿åˆ°äº†ä¸€ä»½å¤§æ¦‚ 13M trace.nettrace æ•°æ®, è¿™ä¸ªæ–‡ä»¶æ˜¯ PerView æ”¯æŒçš„æ ¼å¼ï¼Œ</p><p>åœ¨ MacOS æˆ–è€… Linux ä¸Šæ— æ³•ä½¿ç”¨ã€‚</p><p>å¥½åœ¨ dotnet-trace convert å¯ä»¥å°† trace.nettrace è½¬æ¢æˆ speedscope/chromium ä¸¤ç§æ ¼å¼ã€‚</p><h4 id=speedscopechromium>speedscope/chromium</h4><ul><li><p><a class=link href=https://github.com/jlfwong/speedscope target=_blank rel=noopener>speedscope:A fast, interactive web-based viewer for performance profiles.</a></p></li><li><p><a class=link href=https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/ target=_blank rel=noopener>chrome-devtools evaluate-performance</a></p></li><li><p><a class=link href=https://zhuanlan.zhihu.com/p/29879682 target=_blank rel=noopener>å…¨æ–° Chrome Devtool Performance ä½¿ç”¨æŒ‡å—</a></p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>$dotnet</span>-trace convert 20200606-1753-trace.nettrace.txt  --format Speedscope
</span></span><span class=line><span class=cl><span class=nv>$dotnet</span>-trace convert 20200606-1753-trace.nettrace.txt --format chromium
</span></span><span class=line><span class=cl><span class=nv>$speedscope</span> 20200606-1753-trace.nettrace.speedscope.json
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åï¼Œç‚¸é¸¡äº†ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>âœ</span>  <span class=n>Downloads</span> <span class=n>speedscope</span> <span class=mi>20200606</span><span class=o>-</span><span class=mf>1625.</span><span class=n>trace</span><span class=o>.</span><span class=n>speedscope</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl><span class=n>Error</span><span class=p>:</span> <span class=n>Cannot</span> <span class=n>create</span> <span class=n>a</span> <span class=n>string</span> <span class=n>longer</span> <span class=n>than</span> <span class=mh>0x3fffffe7</span> <span class=n>characters</span>
</span></span><span class=line><span class=cl>    <span class=n>at</span> <span class=ne>Object</span><span class=o>.</span><span class=n>slice</span> <span class=p>(</span><span class=n>buffer</span><span class=o>.</span><span class=n>js</span><span class=p>:</span><span class=mi>652</span><span class=p>:</span><span class=mi>37</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>at</span> <span class=n>Buffer</span><span class=o>.</span><span class=n>toString</span> <span class=p>(</span><span class=n>buffer</span><span class=o>.</span><span class=n>js</span><span class=p>:</span><span class=mi>800</span><span class=p>:</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>at</span> <span class=n>main</span> <span class=p>(</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>liguobao</span><span class=o>/.</span><span class=n>nvm</span><span class=o>/</span><span class=n>versions</span><span class=o>/</span><span class=n>node</span><span class=o>/</span><span class=n>v12</span><span class=o>.</span><span class=mf>16.2</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>node_modules</span><span class=o>/</span><span class=n>speedscope</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>cli</span><span class=o>.</span><span class=n>js</span><span class=p>:</span><span class=mi>69</span><span class=p>:</span><span class=mi>39</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>at</span> <span class=n>processTicksAndRejections</span> <span class=p>(</span><span class=n>internal</span><span class=o>/</span><span class=n>process</span><span class=o>/</span><span class=n>task_queues</span><span class=o>.</span><span class=n>js</span><span class=p>:</span><span class=mi>97</span><span class=p>:</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Usage</span><span class=p>:</span> <span class=n>speedscope</span> <span class=p>[</span><span class=n>filepath</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>If</span> <span class=n>invoked</span> <span class=n>with</span> <span class=n>no</span> <span class=n>arguments</span><span class=p>,</span> <span class=n>will</span> <span class=n>open</span> <span class=n>a</span> <span class=n>local</span> <span class=n>copy</span> <span class=n>of</span> <span class=n>speedscope</span> <span class=ow>in</span> <span class=n>your</span> <span class=n>default</span> <span class=n>browser</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>Once</span> <span class=n>open</span><span class=p>,</span> <span class=n>you</span> <span class=n>can</span> <span class=n>browse</span> <span class=k>for</span> <span class=n>a</span> <span class=n>profile</span> <span class=n>to</span> <span class=n>import</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>If</span> <span class=o>-</span> <span class=n>is</span> <span class=n>used</span> <span class=n>as</span> <span class=n>the</span> <span class=n>filepath</span><span class=p>,</span> <span class=n>will</span> <span class=n>read</span> <span class=n>from</span> <span class=n>stdin</span> <span class=n>instead</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>cat</span> <span class=o>/</span><span class=n>path</span><span class=o>/</span><span class=n>to</span><span class=o>/</span><span class=n>profile</span> <span class=o>|</span> <span class=n>speedscope</span> <span class=o>-</span>
</span></span></code></pre></td></tr></table></div></div><p>å“¦ï¼Œ Buffer.toString ç‚¸é¸¡äº†ã€‚</p><p>çœ‹ä¸€çœ¼ 20200606-1625.trace.speedscope.json å¤šå¤§?</p><p>900Mã€‚</p><p>ç‰›é€¼ã€‚</p><p>é‚£æ¢ Chrome performance çœ‹çœ‹ã€‚</p><p><img src=http://qiniu.house2048.cn/chrome-performance.png loading=lazy alt=chrome-performance></p><p>æ‰‹åŠ¨è£…è½½ä¸€ä¸‹ 20200606-1753-trace.nettrace.chromium.json çœ‹çœ‹ã€‚</p><p>ç­‰ä¸‹ï¼Œ20200606-1753-trace.nettrace.chromium.json è¿™è´§å¤šå¤§ï¼Ÿ</p><p>å“¦ï¼Œ4Gã€‚åº”è¯¥æ²¡äº‹ï¼ŒIntel NUC ä¸»æœºå†…å­˜ç©ºé—² 20Gï¼Œåƒæ‰ 4G å®Œå…¨æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p><img src=http://qiniu.house2048.cn/chrome_performance_load_json.png loading=lazy alt=chrome_performance_load_json></p><p>çœ‹ç€è¿›åº¦æ¡åŠ è½½ï¼Œçœ‹ç€å†…å­˜æ¶¨èµ·æ¥ï¼Œ</p><p>ç„¶å&mldr;Chrome æ§åˆ¶å°å¥”æºƒã€‚å†è§å†è§ï¼ŒåŸæ¥å¤§å®¶å½¼æ­¤å®Œå…¨æ²¡æœ‰ä¿¡ä»»äº†ã€‚</p><p>å”‰ï¼Œå†æ¥ä¸€æ¬¡ï¼ŒæŠŠæ–‡ä»¶æ§åˆ¶åœ¨ 5M å·¦å³çœ‹çœ‹ã€‚</p><p>æœ€åï¼ŒæŠŠ 20200606-1753-trace.nettrace.chromium.json æ§åˆ¶åœ¨ 1.5G äº†ï¼Œ</p><p>ç»ˆäºå¯ä»¥æ­£å¸¸åŠ è½½èµ·æ¥äº†ã€‚</p><hr><h3 id=chrome-performance>Chrome Performance</h3><p>é¦–å…ˆï¼Œ æˆ‘ä»¬çœ‹åˆ°ç›‘æ§é‡Œé¢æœ‰ä¸€å †çš„çº¿ç¨‹</p><p><img src=http://qiniu.house2048.cn/Chrome%20performance_threading_74.png loading=lazy alt=Chrome%20performance_threading_74></p><p>éšä¾¿é€‰ä¸€ä¸ªçº¿ç¨‹çœ‹çœ‹å®ƒåšæ’’,é€‰æ‹© Call Tree ä¹‹å ç‚¹ç‚¹ç‚¹ç‚¹ç‚¹ã€‚</p><p><img src=http://qiniu.house2048.cn/Chrome%20performance_74_call_tree.png loading=lazy alt=20performance_74_call_tree></p><p>ä»è°ƒç”¨æ ˆèƒ½çœ‹åˆ° æ•´ä¸ªçº¿ç¨‹å½“å‰çŠ¶æ€æ˜¯â€œPerformWaitCallbackâ€</p><p>æ•´ä¸ªæ“ä½œåº”è¯¥çš„å¼€å¤´åº”è¯¥æ˜¯</p><p>Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Infrastructure.KestrelConnection.System.Threading.IThreadPoolWorkItem.Execute()</p><p>PSï¼š Kestrel (<a class=link href=https://github.com/aspnet/KestrelHttpServer target=_blank rel=noopener>https://github.com/aspnet/KestrelHttpServer</a>) is a lightweight cross-platform web server that supports .NET Core and runs on multiple platforms such as Linux, macOS, and Windows. Kestrel is fully written in .Net core. It is based on libuv which is a multi-platform asynchronous eventing library.</p><p>PS äººè¯ï¼š .NET Core å†…ç½®çš„ HTTP Serverï¼Œå’Œ Spring Boot ä¸­çš„ tomcat ç»„ä»¶ç±»ä¼¼</p><p>å¾ˆæ­£å¸¸ï¼Œè¯´æ˜è¯·æ±‚æ­£å¸¸åˆ°äº†æˆ‘ä»¬çš„æœåŠ¡é‡Œé¢äº†ã€‚</p><p>å†çœ‹ä¸€ä¸‹å‰©ä¸‹çš„è°ƒç”¨é“¾ä¿¡æ¯ã€‚</p><p><img src=http://qiniu.house2048.cn/dotnet-call-tree-di.png loading=lazy alt=dotnet-call-tree-di></p><p>ç®€è¦çš„è°ƒç”¨ä¿¡æ¯æ—¥å¿—åœ¨è¿™é‡Œï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start(!!0&amp;)
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Infrastructure.KestrelConnection+&lt;ExecuteAsync&gt;d__32.MoveNext()
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.Server.Kestrel.Core.Internal.HttpConnectionMiddleware`1[System.__Canon].OnConnectionAsync(class Microsoft.AspNetCore.Connections.ConnectionContext)   Microsoft.AspNetCore.Server.Kestrel.Core.Internal.HttpConnection.ProcessRequestsAsync(class Microsoft.AspNetCore.Hosting.Server.IHttpApplication`1&lt;!!0&gt;)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start(!!0&amp;)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start(!!0&amp;)
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.Server.Kestrel.Core.Internal.HttpConnection+&lt;ProcessRequestsAsync&gt;d__12`1[System.__Canon].MoveNext()
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequestsAsync(class Microsoft.AspNetCore.Hosting.Server.IHttpApplication`1&lt;!!0&gt;)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start(!!0&amp;)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start(!!0&amp;)
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol+&lt;ProcessRequestsAsync&gt;d__216`1[System.__Canon].MoveNext()
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests(class Microsoft.AspNetCore.Hosting.Server.IHttpApplication`1&lt;!!0&gt;)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start(!!0&amp;)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start(!!0&amp;)
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol+&lt;ProcessRequests&gt;d__217`1[System.__Canon].MoveNext()
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.Hosting.HostingApplication.ProcessRequestAsync(class Context)
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.HostFiltering.HostFilteringMiddleware.Invoke(class Microsoft.AspNetCore.Http.HttpContext)
</span></span><span class=line><span class=cl>UserCenter.ErrorHandlingMiddleware.Invoke(class Microsoft.AspNetCore.Http.HttpContext)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start(!!0&amp;)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start(!!0&amp;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>......
</span></span><span class=line><span class=cl>......
</span></span><span class=line><span class=cl>......
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>e.StaticFiles.StaticFileMiddleware.Invoke(class Microsoft.AspNetCore.Http.HttpContext)
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.Builder.UseMiddlewareExtensions+&lt;&gt;c__DisplayClass4_1.&lt;UseMiddleware&gt;b__2(class Microsoft.AspNetCore.Http.HttpContext)
</span></span><span class=line><span class=cl>dynamicClass.lambda_method(pMT: 00007FB6D3BBE570,class System.Object,pMT: 00007FB6D4739560,pMT: 00007FB6D0BF4F98)
</span></span><span class=line><span class=cl>Microsoft.AspNetCore.Builder.UseMiddlewareExtensions.GetService(class System.IServiceProvider,class System.Type,class System.Type)
</span></span><span class=line><span class=cl>Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(class System.Type)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start(!!0&amp;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2[Microsoft.Extensions.DependencyInjection.ServiceLookup.RuntimeResolverContext,System.__Canon].VisitCallSite(class Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceCallSite,!0)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start(!!0&amp;)
</span></span><span class=line><span class=cl>System.Runtime.CompilerServices.AsyncTaskMethodBuilder.Start(!!0&amp;)
</span></span></code></pre></td></tr></table></div></div><p>çœ‹åˆ°è¿™é‡Œï¼Œå…¶å®åˆæœ‰äº†ä¸€äº›å¾ˆç»™åŠ›çš„ä¿¡æ¯è¢«æš´éœ²å‡ºæ¥äº†ã€‚</p><hr><h4 id=performwaitcallback>PerformWaitCallback</h4><ul><li>ç›´æ¥å­—é¢ç†è§£ï¼Œçº¿ç¨‹æ­£åœ¨æ‰§è¡Œç­‰å¾…å›è°ƒ</li></ul><h4 id=è°ƒç”¨é“¾ä¿¡æ¯>è°ƒç”¨é“¾ä¿¡æ¯</h4><p>è€å¿ƒç‚¹ï¼ŒæŠŠæ‰€æœ‰çš„ç”µè°ƒç”¨é“¾éƒ½å±•å¼€ã€‚</p><p>æˆ‘ä»¬èƒ½çœ‹åˆ°ç¨‹åºå·²ç»ä¾æ¬¡ç»è¿‡äº†ä¸‹é¢å‡ ä¸ªæµç¨‹ï¼š</p><p>->ProcessRequestsAsync(ç³»ç»Ÿ)</p><p>->ErrorHandlingMiddleware(å·²ç»åŠ è½½äº†è‡ªå®šä¹‰çš„é”™è¯¯ä¸­é—´ä»¶)</p><p>-> HostFilteringMiddleware(åŠ è½½äº† Filter ä¸­é—´ä»¶)</p><p>-> Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor(è°ƒç”¨é“¾ä¸­çš„æœ€åä¸€ä¸ªæ“ä½œ)</p><p>å¯¹åº”æœ€ä¸Šé¢çš„æ—¥å¿—æ¥è¯´ï¼Œ</p><p>è¯·æ±‚è¿›æ¥ï¼Œç»è¿‡äº†ä¸­é—´ä»¶å’Œ Filter éƒ½æ˜¯æ²¡é—®é¢˜çš„ï¼Œ</p><p>æœ€ååœ¨ DependencyInjectionï¼ˆä¾èµ–æ³¨å…¥ï¼‰ ä¸­æ²¡æœ‰äº†è¸ªè¿¹ã€‚</p><p>åˆ°è¿™é‡Œï¼Œ</p><p>å†æ¬¡éªŒè¯æˆ‘ä»¬æ˜¨å¤©çš„æ€è·¯ï¼š</p><h3 id=è¿™æ˜¯ä¸€ä¸ª-èµ„æºé˜»å¡é—®é¢˜äº§ç”Ÿçš„é—®é¢˜>è¿™æ˜¯ä¸€ä¸ª â€œèµ„æºé˜»å¡é—®é¢˜â€äº§ç”Ÿçš„é—®é¢˜</h3><p>è™½ç„¶åš ptrace æ˜¯æƒ³èƒ½ç›´æ¥æŠ“åˆ°â€œå‡¶æ‰‹â€çš„ï¼Œ</p><p>æœ€åå‘ç°å¹¶æ²¡æœ‰èƒ½è·Ÿè¸ªåˆ°å…·ä½“çš„å®ç°ï¼Œ</p><p>é‚£å¯å’‹åŠå‘¢ï¼Ÿ</p><h2 id=æ§åˆ¶å˜é‡å®è·µ>æ§åˆ¶å˜é‡å®è·µ</h2><p>å·²çŸ¥ï¼š</p><ul><li>å¹¶å‘ 300 è®¿é—® /v1/user/test/account-balance æ¥å£ç¨‹åºä¼šå‡æ­»</li><li>ç§»é™¤ Filter ä¸­é—´ä»¶ä¸èƒ½è§£å†³é—®é¢˜</li><li>å¹¶å‘ 300 è®¿é—® /v1/health å¥åº·æ£€æŸ¥æ¥å£ç¨‹åºæ­£å¸¸</li><li>ptrace ä¿¡æ¯å‘Šè¯‰æˆ‘ä»¬æœ‰â€œä¸œè¥¿â€åœ¨é˜»å¡ DI å®¹å™¨åˆ›å»ºæŸäº›å®ä¾‹</li></ul><p>å¼€å§‹æ§åˆ¶å˜é‡ + äººè‚‰äºŒåˆ†æŸ¥æ‰¾ã€‚</p><h3 id=æŒªæ¥å£ä»£ç >æŒªæ¥å£ä»£ç </h3><p>/v1/user/test/account-balance çš„é€»è¾‘æ˜¯ç”± AccountService å®ç°çš„ï¼Œ</p><p>AccountService å¤§æ¦‚ä¾èµ–å››äº”ä¸ªå…¶ä»–çš„ Service å’Œ DBContextï¼Œ</p><p>æœ€ä¸»è¦çš„é€»è¾‘æ˜¯åŠ è½½ç”¨æˆ·å‡ ä¸ªè´¦å·ï¼Œç„¶åè®¡ç®—ä¸€ä¸‹ balanceã€‚</p><p>å¤§æ¦‚ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// è·å–ç”¨æˆ·çš„AccountBalanceæ±‡æ€»ä¿¡æ¯</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=n>AccountBalanceStat</span><span class=p>&gt;</span> <span class=n>LoadAccountBalanceStatAsync</span><span class=p>(</span><span class=kt>string</span> <span class=n>owner</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// æ•°æ®åº“æŸ¥è¯¢</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>accounts</span> <span class=p>=</span> <span class=k>await</span> <span class=n>_dbContext</span><span class=p>.</span><span class=n>BabelAccounts</span><span class=p>.</span><span class=n>Where</span><span class=p>(</span><span class=n>ac</span> <span class=p>=&gt;</span> <span class=n>ac</span><span class=p>.</span><span class=n>Owner</span> <span class=p>==</span> <span class=n>owner</span><span class=p>).</span><span class=n>ToListAsync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// å†…å­˜è®¡ç®—</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ConvertToAccountBalanceStat</span><span class=p>(</span><span class=n>accounts</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä»€ä¹ˆéƒ½ä¸æ”¹ï¼Œç›´æ¥æŠŠä»£ç  CP åˆ° Health æ¥å£æµ‹ä¸€ä¸‹ã€‚</p><p>ç¥å¥‡ï¼Œ300 å¹¶å‘æŠ—ä½äº†ã€‚</p><p>ç»“è®ºï¼š</p><ul><li>ä¸Šé¢è¿™ä¸€æ®µä»£ç å¹¶ä¸ä¼šå¯¼è‡´æœåŠ¡åƒµæ­»</li><li>æ•°æ®åº“é©±åŠ¨æ²¡æœ‰é—®é¢˜ï¼ŒDbContext æ²¡æœ‰é—®é¢˜ï¼Œæ•°æ®åº“èµ„æºä½¿ç”¨æ²¡æœ‰é—®é¢˜</li><li>å½“å‰å¹¶ä¸ä¼šè§¦å‘ DI å®¹å™¨å¼‚å¸¸ï¼Œ é—®é¢˜å‡ºåœ¨ /v1/user/test/account-balance åˆå§‹åŒ–</li></ul><h3 id=account-balance-æœ‰ä»€ä¹ˆç¥å¥‡çš„ä¸œè¥¿å—>account-balance æœ‰ä»€ä¹ˆç¥å¥‡çš„ä¸œè¥¿å—ï¼Ÿ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl><span class=cs>/// æŸ¥è¯¢ç”¨æˆ·çš„Brickè´¦å·ä½™é¢</span>
</span></span><span class=line><span class=cl><span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl><span class=na>[HttpGet(&#34;v1/user/{owner}/account-balance&#34;)]</span>
</span></span><span class=line><span class=cl><span class=na>[SwaggerResponse(200, &#34;è·å–æˆåŠŸ&#34;, typeof(AccountBrickStat))]</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=n>IActionResult</span><span class=p>&gt;</span> <span class=n>GetAccountBricks</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=na>    [FromRoute, SwaggerParameter(&#34;æ‰€æœ‰è€…&#34;, Required = true)]</span> <span class=kt>string</span> <span class=n>owner</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>owner</span> <span class=p>=</span> <span class=k>await</span> <span class=n>_userService</span><span class=p>.</span><span class=n>FindOwnerAsync</span><span class=p>(</span><span class=n>owner</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Ok</span><span class=p>(</span><span class=k>new</span> <span class=p>{</span> <span class=n>data</span> <span class=p>=</span> <span class=k>await</span> <span class=n>_accountService</span><span class=p>.</span><span class=n>LoadAccountAsync</span><span class=p>(</span><span class=n>owner</span><span class=p>),</span> <span class=n>code</span> <span class=p>=</span> <span class=m>0</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬åˆšåˆšéªŒè¯äº† LoadAccountAsync çš„ä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œ</p><p>è¦ä¸ UserService DI æœ‰é—®é¢˜ï¼Œè¦ä¸ AccountService DI æœ‰é—®é¢˜ã€‚</p><p>æŠŠ UserService åŠ å…¥åˆ° HealthController ä¸­ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=n>HealthController</span><span class=p>(</span><span class=n>UserService</span> <span class=n>userService</span><span class=p>,</span> <span class=n>UserPoolDataContext</span> <span class=n>dbContext</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>_dbContext</span> <span class=p>=</span> <span class=n>dbContext</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>_userService</span><span class=p>=</span> <span class=n>userService</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Boolã€‚</p><p>300 å¹¶å‘æ²¡æœ‰æ’‘ä½ï¼Œç¨‹åºåƒµæ­»å•¦ã€‚</p><p>å®Œç¾ï¼Œ</p><p>é—®é¢˜åº”è¯¥åœ¨ UserService DI åˆå§‹åŒ–äº†ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯ä¸€ä¸ªä¸ªéªŒè¯ UserService DI éœ€è¦çš„èµ„æºï¼Œ</p><p>EmailSDK æ²¡æœ‰é—®é¢˜ï¼Œ</p><p>HTTPHeaderTools æ²¡æœ‰é—®é¢˜ï¼Œ</p><p>UserActivityLogService æ²¡æœ‰é—®é¢˜ã€‚</p><p>RedisClient&mldr;
RedisClient&mldr;
RedisClient&mldr;</p><p>OK
OK
Ok</p><p>å¤ç°ç‚¸é¸¡äº†ã€‚</p><hr><h2 id=åŸæ¥æ˜¯-redis-çš„é”…>åŸæ¥æ˜¯ Redis çš„é”…ï¼Ÿ</h2><p>æ˜¯ï¼Œ</p><p>ä¹Ÿä¸æ˜¯ã€‚</p><p>å…ˆçœ‹ä¸‹æˆ‘ä»¬ RedisClient æ˜¯æ€ä¹ˆä½¿ç”¨çš„ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C# data-lang=C#><span class=line><span class=cl><span class=c1>// startup.cs æ³¨å…¥äº†å•ä¾‹çš„ConnectionMultiplexer</span>
</span></span><span class=line><span class=cl><span class=c1>// ç¨‹åºå¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨InitRedis</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=k>void</span> <span class=n>InitRedis</span><span class=p>(</span><span class=n>IServiceCollection</span> <span class=n>services</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>&lt;</span><span class=n>ConnectionMultiplexer</span><span class=p>,</span> <span class=n>ConnectionMultiplexer</span><span class=p>&gt;(</span><span class=n>factory</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ConfigurationOptions</span> <span class=n>options</span> <span class=p>=</span> <span class=n>ConfigurationOptions</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Configuration</span><span class=p>[</span><span class=s>&#34;RedisConnectionString&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>options</span><span class=p>.</span><span class=n>SyncTimeout</span> <span class=p>=</span> <span class=m>10</span> <span class=p>*</span> <span class=m>10000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ConnectionMultiplexer</span><span class=p>.</span><span class=n>Connect</span><span class=p>(</span><span class=n>options</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//RedisClient.cs é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>RedisClient</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ConnectionMultiplexer</span> <span class=n>_redisMultiplexer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=k>readonly</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>RedisClient</span><span class=p>&gt;</span> <span class=n>_logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>RedisClient</span><span class=p>(</span><span class=n>ConnectionMultiplexer</span> <span class=n>redisMultiplexer</span><span class=p>,</span> <span class=n>ILogger</span><span class=p>&lt;</span><span class=n>RedisService</span><span class=p>&gt;</span> <span class=n>logger</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_redisMultiplexer</span> <span class=p>=</span> <span class=n>redisMultiplexer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>_logger</span> <span class=p>=</span> <span class=n>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>DI åˆå§‹åŒ– RedisClient å®ä¾‹çš„æ—¶å€™ï¼Œ</p><p>éœ€è¦æ‰§è¡Œ ConnectionMultiplexer.Connect æ–¹æ³•ï¼Œ</p><p>ConnectionMultiplexer.Connect æ˜¯åŒæ­¥é˜»å¡çš„ã€‚</p><p>ConnectionMultiplexer.Connect æ˜¯åŒæ­¥é˜»å¡çš„ã€‚</p><p>ConnectionMultiplexer.Connect æ˜¯åŒæ­¥é˜»å¡çš„ã€‚</p><p>ä¸€åˆ‡éƒ½èƒ½è§£é‡Šäº†ã€‚</p><p>æ€ä¹ˆæ”¹ï¼Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c# data-lang=c#><span class=line><span class=cl><span class=c1>// InitRedis ç›´æ¥æŠŠé“¾æ¥åˆ›å»ºå¥½ï¼Œç„¶åç›´æ¥æ³¨å…¥åˆ°IServiceCollectionä¸­</span>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=k>void</span> <span class=n>InitRedis</span><span class=p>(</span><span class=n>IServiceCollection</span> <span class=n>services</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ConfigurationOptions</span> <span class=n>options</span> <span class=p>=</span> <span class=n>ConfigurationOptions</span><span class=p>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>Configuration</span><span class=p>[</span><span class=s>&#34;RedisConnectionString&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>options</span><span class=p>.</span><span class=n>SyncTimeout</span> <span class=p>=</span> <span class=m>10</span> <span class=p>*</span> <span class=m>10000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>redisConnectionMultiplexer</span> <span class=p>=</span> <span class=n>ConnectionMultiplexer</span><span class=p>.</span><span class=n>Connect</span><span class=p>(</span><span class=n>options</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>services</span><span class=p>.</span><span class=n>AddSingleton</span><span class=p>(</span><span class=n>redisConnectionMultiplexer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Log</span><span class=p>.</span><span class=n>Information</span><span class=p>(</span><span class=s>&#34;InitRedis success.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å‘å¸ƒéªŒè¯ï¼Œ</p><p>å¼€é—¨æ”¾å¹¶å‘ 300 + 3000 è¯·æ±‚ã€‚</p><p>å®Œç¾æŠ—ä½ï¼Œä¸ä¸€èˆ¬é¡ºæ»‘ã€‚</p><h3 id=è¿˜æœ‰æ›´ä¼˜çš„å†™æ³•å—>è¿˜æœ‰æ›´ä¼˜çš„å†™æ³•å—ï¼Ÿ</h3><ul><li>çœ‹äº†ä¸‹å¾®è½¯ Cache ä¸­é—´ä»¶æºç ï¼Œæ›´å¥½çš„åšæ³•åº”è¯¥æ˜¯é€šè¿‡ä¿¡å·é‡+å¼‚æ­¥é”æ¥åˆ›å»º Redis é“¾æ¥ï¼Œä¸‹æ¥å†ç ”ç©¶ä¸€ä¸‹</li><li>æ•°æ®åº“ä¸­å¯èƒ½ä¹Ÿå­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ï¼Œä¸è¿‡å½“å‰ä¼šåœ¨ Startup ä¸­æˆ³ä¸€ä¸‹æ•°æ®åº“è¿æ¥ï¼Œåº”è¯¥é—®é¢˜ä¸å¤§ã€‚</li></ul><h2 id=å¤ç›˜>å¤ç›˜</h2><p>ç¨‹åºå¯åŠ¨çš„æ—¶å€™ä¾èµ–æ³¨å…¥å®¹å™¨åŒæ­¥åˆå§‹åŒ– Redis å¯èƒ½å¾ˆæ…¢(å‡ ç§’ç”šè‡³æ›´é•¿)çš„æ—¶å€™ï¼Œ</p><p>å…¶ä»–çš„èµ„æºéƒ½åœ¨åŒæ­¥ç­‰å¾…å®ƒåˆå§‹åŒ–å¥½ï¼Œ</p><p>æœ€ç»ˆå¯¼è‡´è¯·æ±‚å †ç§¯ï¼Œå¼•èµ·ç¨‹åºé›ªå´©æ•ˆåº”ã€‚</p><p>Redis åˆå§‹åŒ–è¿‡æ…¢å¹¶ä¸æ¯æ¬¡éƒ½å‘ç”Ÿï¼Œ æ‰€ä»¥ä¹‹å‰æœåŠ¡ä¹Ÿåªæ˜¯å¶å‘ã€‚</p><p>DI åˆå§‹åŒ– Redis è¿æ¥çš„æ—¶å€™ï¼Œredis æ‰“æ¥è¿æ¥è¿˜æ˜¯ä¸ªåŒæ­¥çš„æ–¹æ³•ï¼Œ</p><p>è¿™ç§æƒ…å†µä¸‹è¿˜å¯èƒ½å‘ç”Ÿå¼‚æ­¥è¯·æ±‚ä¸­ç­‰å¾…åŒæ­¥èµ„æºäº§ç”Ÿé˜»å¡é—®é¢˜ã€‚</p><p>åŒæ—¶è¿˜éœ€è¦æ’æŸ¥ä½¿ç”¨å…¶ä»–å¤–éƒ¨èµ„æºçš„æ—¶å€™æ˜¯å¦ä¼šè§¦å‘åŒç±»é—®é¢˜ã€‚</p><hr><h2 id=å‡ ä¸ªé€šç”¨çš„å°æŠ€å·§>å‡ ä¸ªé€šç”¨çš„å°æŠ€å·§</h2><ul><li><p>ptrace å¯¹æ­¤ç±»é—®é¢˜åˆ†æå¾ˆæœ‰æ„ä¹‰ï¼Œä¸åŒè¯­è¨€æ¡†æ¶éƒ½æœ‰ç±»ä¼¼çš„å®ç°</p></li><li><p>åŒæ­¥ã€å¼‚æ­¥æ¦‚å¿µçš„åŸç†å’Œå®ç°éƒ½è¦äº†è§£ï¼Œè¿™ä¸ªæœ‰åˆ©äºç†è§£ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜</p></li><li><p>ç«ç„°å›¾ã€Chrome dev Performance ã€speedscope éƒ½æ˜¯å¥½ä¸œè¥¿</p></li><li><p>Debug æ—¥å¿—èƒ½ç»™æ›´å¤šçš„ä¿¡æ¯ï¼Œåœ¨éš”ç¦»ç”Ÿäº§çš„æƒ…å†µä¸‹å¤§èƒ†ä½¿ç”¨</p></li><li><p>è¿™è¾ˆå­éƒ½ä¸å¯èƒ½çœ‹æºç çš„ï¼Œå†™å†™ CURD å¤šç¾ä¸½ï¼Ÿæºç çœŸé¦™ï¼Œæºç çœŸç‰›é€¼ã€‚</p></li><li><p>æ§åˆ¶å˜é‡éªŒè¯ï¼Œå¤§èƒ†å‡è®¾ï¼Œå°å¿ƒæ±‚è¯ï¼Œäººè‚‰äºŒåˆ†æŸ¥ï¼Œå…ˆæ€€ç–‘è‡ªå·±å†æ€€ç–‘æ¡†æ¶</p></li><li><p>æäº‹çš„æ—¶å€™ä¸è¦è‡ªå·±ä¸€ä¸ªäººï¼Œæœ‰ Bug ä¸€å®šè¦æ‹‰ä¸Šå°ä¼™ä¼´ä¸€èµ·åƒ</p></li></ul><hr><h2 id=ç›¸å…³èµ„æ–™>ç›¸å…³èµ„æ–™</h2><ul><li><p><a class=link href=https://www.ibm.com/developerworks/cn/linux/l-cn-embedded-ptrace/index.html target=_blank rel=noopener>IBM Developer ptrace åµŒå…¥å¼ç³»ç»Ÿä¸­è¿›ç¨‹é—´é€šä¿¡çš„ç›‘è§†æ–¹æ³•</a></p></li><li><p><a class=link href=https://www.jianshu.com/p/d6686cb72f68 target=_blank rel=noopener>åˆ†æè¿›ç¨‹è°ƒç”¨ pstack å’Œ starce</a></p></li><li><p><a class=link href=https://wangchujiang.com/linux-command/c/pstack.html target=_blank rel=noopener>pstack æ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹çš„æ ˆè·Ÿè¸ª</a></p></li><li><p><a class=link href=https://docs.microsoft.com/en-us/dotnet/core/diagnostics/dotnet-trace target=_blank rel=noopener>å¾®è½¯ï¼šdotnet-trace performance analysis utility</a></p></li><li><p><a class=link href=https://zhuanlan.zhihu.com/p/29879682 target=_blank rel=noopener>çŸ¥ä¹ï¼šå…¨æ–° Chrome Devtool Performance ä½¿ç”¨æŒ‡å—</a></p></li><li><p><a class=link href=https://github.com/jlfwong/speedscope target=_blank rel=noopener>speedscope A fast, interactive web-based viewer for performance profiles.</a></p></li><li><p><a class=link href=https://www.cnblogs.com/duanxz/p/5487576.html target=_blank rel=noopener>jdk å·¥å…·ä¹‹ jstack(Java Stack Trace)</a></p></li><li><p><a class=link href=https://ruanyifeng.com/blog/2017/09/flame-graph.html target=_blank rel=noopener>é˜®ä¸€å³°:å¦‚ä½•è¯»æ‡‚ç«ç„°å›¾ï¼Ÿ</a></p></li></ul></section><footer class=article-footer><section class=article-tags><a href=/zh/tags/di/>DI</a>
<a href=/zh/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/>ä¾èµ–æ³¨å…¥</a>
<a href=/zh/tags/.net-core/>.NET Core</a>
<a href=/zh/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/>å¼‚æ­¥ç¼–ç¨‹</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><script src=https://utteranc.es/client.js repo=liguobao/liguobao.github.io issue-term=title crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 äººç”Ÿåˆ é™¤æŒ‡å—</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>