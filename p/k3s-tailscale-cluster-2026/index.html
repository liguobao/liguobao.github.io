<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="A cross-cloud edge computing cluster solution based on self-hosted Tailscale control plane + K3s, with practical 8-node HA cluster deployment."><title>Best Edge Computing Cluster Solution: Tailscale + K3s (2026 Edition)</title><link rel=canonical href=https://liguobao.github.io/p/k3s-tailscale-cluster-2026/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Best Edge Computing Cluster Solution: Tailscale + K3s (2026 Edition)"><meta property='og:description' content="A cross-cloud edge computing cluster solution based on self-hosted Tailscale control plane + K3s, with practical 8-node HA cluster deployment."><meta property='og:url' content='https://liguobao.github.io/p/k3s-tailscale-cluster-2026/'><meta property='og:site_name' content='Life Deletion Guide'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='k3s'><meta property='article:tag' content='tailscale'><meta property='article:tag' content='kubernetes'><meta property='article:tag' content='2026'><meta property='article:published_time' content='2026-02-12T08:00:00+00:00'><meta property='article:modified_time' content='2026-02-12T08:00:00+00:00'><meta property='og:image' content='https://liguobao.github.io/zh/p/k3s-tailscale-cluster-2026/logo.png'><meta name=twitter:title content="Best Edge Computing Cluster Solution: Tailscale + K3s (2026 Edition)"><meta name=twitter:description content="A cross-cloud edge computing cluster solution based on self-hosted Tailscale control plane + K3s, with practical 8-node HA cluster deployment."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://liguobao.github.io/zh/p/k3s-tailscale-cluster-2026/logo.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/zhihu-lgb_hu_2ad0a9defe137384.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>Life Deletion Guide</a></h1><h2 class=site-description>liguobao</h2></div></header><ol class=menu-social><li><a href=https://github.com/liguobao target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/Liguobao2049 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://www.zhihu.com/people/codelover target=_blank title=çŸ¥ä¹ rel=me><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/liguobao-resume/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>About</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://liguobao.github.io/zh/>ç®€ä½“ä¸­æ–‡</option><option value=https://liguobao.github.io/ selected>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#overall-architecture>Overall Architecture</a></li><li><a href=#part-i-setting-up-tailscale---cloud-internal-network-cluster>Part I: Setting up Tailscale - Cloud Internal Network Cluster</a><ol><li><a href=#why-not-manually-configure-wireguard-anymore>Why Not Manually Configure WireGuard Anymore?</a></li><li><a href=#why-self-host-headscale>Why Self-host Headscale?</a></li><li><a href=#headscale-deployment>Headscale Deployment</a></li><li><a href=#node-onboarding>Node Onboarding</a></li></ol></li><li><a href=#part-ii-k3s-cluster-setup---based-on-tailscale-network>Part II: K3s Cluster Setup - Based on Tailscale Network</a><ol><li><a href=#core-principles>Core Principles</a></li><li><a href=#installing-masters>Installing Masters</a></li><li><a href=#installing-edge-nodes>Installing Edge Nodes</a></li><li><a href=#domestic-docker-image-pulling-issues>Domestic Docker Image Pulling Issues</a></li><li><a href=#about-gateway-nodes>About Gateway Nodes</a></li></ol></li><li><a href=#part-iii-pitfall-chronicles>Part III: Pitfall Chronicles</a><ol><li><a href=#pitfall-1-flannel-using-wrong-nic-hard-learned-lesson>Pitfall 1: Flannel Using Wrong NIC (Hard-learned Lesson)</a></li><li><a href=#pitfall-2-unstable-tailscale-connection>Pitfall 2: Unstable Tailscale Connection</a></li><li><a href=#pitfall-3-dont-run-business-pods-on-low-spec-masters>Pitfall 3: Don&rsquo;t Run Business Pods on Low-spec Masters</a></li></ol></li><li><a href=#part-iv-troubleshooting-quick-reference>Part IV: Troubleshooting Quick Reference</a></li><li><a href=#part-v-summary>Part V: Summary</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/k3s-tailscale-cluster-2026/><img src=/zh/p/k3s-tailscale-cluster-2026/logo_hu_5d6e6e4068c405d9.png srcset="/zh/p/k3s-tailscale-cluster-2026/logo_hu_5d6e6e4068c405d9.png 800w, /zh/p/k3s-tailscale-cluster-2026/logo_hu_42407341a6dd794.png 1600w" width=800 height=179 loading=lazy alt="Featured image of post Best Edge Computing Cluster Solution: Tailscale + K3s (2026 Edition)"></a></div><div class=article-details><header class=article-category><a href=/categories/linux/ style=background-color:#2a9d8f;color:#fff>Linux</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/k3s-tailscale-cluster-2026/>Best Edge Computing Cluster Solution: Tailscale + K3s (2026 Edition)</a></h2><h3 class=article-subtitle>A cross-cloud edge computing cluster solution based on self-hosted Tailscale control plane + K3s, with practical 8-node HA cluster deployment.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Feb 12, 2026</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>11 minute read</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://liguobao.github.io/zh/p/k3s-tailscale-cluster-2026/ class=link>ç®€ä½“ä¸­æ–‡</a></div></footer></div></header><section class=article-content><blockquote><p>PS: Holiday&rsquo;s coming, time for more tinkering!!</p></blockquote><p><em>Manual dog head emoji</em></p><p>ã€Programming Tech Zone Disclaimerã€‘</p><p>My last k3s article was written in 2025, using WireGuard for cross-cloud networking.</p><p>A year has passed, and WireGuard configuration is still too tedious.</p><p>â€”Every time you add a machine, you have to manually edit configs, add peers, adjust routes&mldr;</p><p>So this year, I decided to switch the underlying network entirely to Tailscale.</p><p>More specificallyâ€”self-hosting a Headscale control plane, without relying on the official SaaS.</p><p>This way, you can add as many nodes to the internal network as you want,</p><p>with a one-line command to join the network, no more manual WireGuard Peer configuration management.</p><p>At the same time, the k3s cluster has been upgraded from a humble 2-node version,</p><p>to an <strong>8-node HA cluster with 4 Masters + 4 Edges</strong>.</p><p>Small but complete.</p><p>Let&rsquo;s get to it.</p><h2 id=overall-architecture>Overall Architecture</h2><p>First, here&rsquo;s an architecture diagram for a global overview:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>                    Internet
</span></span><span class=line><span class=cl>                      â”‚
</span></span><span class=line><span class=cl>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>        â”‚             â”‚             â”‚
</span></span><span class=line><span class=cl>    [Tencent Cloud] [Rainyun]    [Local]
</span></span><span class=line><span class=cl>    (Domestic)   (Singapore)   (Home/Office)
</span></span><span class=line><span class=cl>        â”‚             â”‚             â”‚
</span></span><span class=line><span class=cl>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class=line><span class=cl>                      â”‚
</span></span><span class=line><span class=cl>           Tailscale VPN (100.64.0.0/10)
</span></span><span class=line><span class=cl>          Headscale Self-hosted (ts.example.com)
</span></span><span class=line><span class=cl>          Authentik OIDC Login (auth.example.com)
</span></span><span class=line><span class=cl>                      â”‚
</span></span><span class=line><span class=cl>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>        â”‚          â”‚          â”‚          â”‚
</span></span><span class=line><span class=cl>    [control1] [control2] [control3] [control4]
</span></span><span class=line><span class=cl>    vm-0-8     vm-16-12   vm-28-17   vm-0-15
</span></span><span class=line><span class=cl>   100.64.0.6 100.64.0.5 100.64.0.7 100.64.0.10
</span></span><span class=line><span class=cl>    (Primary)  (Member)   (Member)  (TS Control)
</span></span><span class=line><span class=cl>        â”‚          â”‚          â”‚          â”‚
</span></span><span class=line><span class=cl>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class=line><span class=cl>                      â”‚
</span></span><span class=line><span class=cl>        K3S HA Cluster (Flannel VXLAN over Tailscale)
</span></span><span class=line><span class=cl>        Pod: 10.42.0.0/16  |  Service: 10.43.0.0/16
</span></span><span class=line><span class=cl>                      â”‚
</span></span><span class=line><span class=cl>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class=line><span class=cl>        â”‚         â”‚         â”‚         â”‚
</span></span><span class=line><span class=cl>     [haru]  [lgb-amd]  [rainyun]  [hc1]
</span></span><span class=line><span class=cl>    Domestic   Local    Overseas  Domestic
</span></span><span class=line><span class=cl>    Ready âœ…  Ready âœ…  Ready âœ…  Ready âœ…
</span></span></code></pre></td></tr></table></div></div><p>Current cluster state:</p><div class=table-wrapper><table><thead><tr><th>Node Name</th><th>Role</th><th>Tailscale IP</th><th>Status</th><th>Notes</th></tr></thead><tbody><tr><td>vm-0-8-ubuntu-new</td><td>Master</td><td>100.64.0.6</td><td>Ready âœ…</td><td>Initial Master, &ndash;cluster-init</td></tr><tr><td>vm-16-12-ubuntu</td><td>Master</td><td>100.64.0.5</td><td>Ready âœ…</td><td>HA Master</td></tr><tr><td>vm-28-17-ubuntu</td><td>Master</td><td>100.64.0.7</td><td>Ready âœ…</td><td>HA Master</td></tr><tr><td>vm-0-15-ubuntu</td><td>Master</td><td>100.64.0.10</td><td>Ready âœ…</td><td>Headscale control plane node, NoSchedule</td></tr><tr><td>haru</td><td>Edge</td><td>100.64.0.3</td><td>Ready âœ…</td><td>Domestic node</td></tr><tr><td>lgb-amd-3700</td><td>Edge</td><td>100.64.0.4</td><td>Ready âœ…</td><td>Local AMD host, 16GB</td></tr><tr><td>rainyun-ssh7pavp</td><td>Edge</td><td>100.64.0.12</td><td>Ready âœ…</td><td>Overseas Singapore node</td></tr><tr><td>hc1</td><td>Edge</td><td>100.64.0.9</td><td>Ready âœ…</td><td>Domestic node</td></tr></tbody></table></div><p>8-node cluster running dozens of services, stable as a rock.</p><h2 id=part-i-setting-up-tailscale---cloud-internal-network-cluster>Part I: Setting up Tailscale - Cloud Internal Network Cluster</h2><h3 id=why-not-manually-configure-wireguard-anymore>Why Not Manually Configure WireGuard Anymore?</h3><p>In the 2025 article, I used the native WireGuard solution + k3s Flannel <code>wireguard-native</code> mode.</p><p>To be honest, WireGuard itself is very stable with good performance. But manually managing peers becomes a nightmare when you have multiple nodes:</p><ul><li>Every time you add a node, you need to update WireGuard configs on all other nodes</li><li>Public key exchange and IP allocation are all manual</li><li>If a machine&rsquo;s public IP changes, all peers need to be updated</li><li>No unified management interface</li></ul><p>So this time, I went straight to Tailscale.</p><h3 id=why-self-host-headscale>Why Self-host Headscale?</h3><p>Tailscale&rsquo;s official SaaS service is certainly convenient, and the personal plan now supports up to 100 devices, which is more than enough. But there are a few issues:</p><ol><li><strong>Login requires external network</strong>â€”Tailscale login authentication uses Google/Microsoft/GitHub OAuth, basically unusable from mainland China without VPN, especially troublesome on servers</li><li><strong>Data control</strong>â€”All node information is on someone else&rsquo;s servers, not reassuring</li><li><strong>Domestic access</strong>â€”Tailscale&rsquo;s official coordination server is overseas, domestic nodes have unstable connections, occasionally slow to establish connections between nodes</li></ol><p>So I chose <a class=link href=https://github.com/juanfont/headscale target=_blank rel=noopener>Headscale</a>â€”an open-source Tailscale control plane implementation.</p><p>Combined with <a class=link href=https://goauthentik.io/ target=_blank rel=noopener>Authentik</a> for OIDC login, the experience is almost identical to official Tailscale, even more flexible.</p><h3 id=headscale-deployment>Headscale Deployment</h3><p><strong>Server requirements</strong>: A small 2C2G machine is enough, I&rsquo;m using Tencent Cloud Lighthouse Ubuntu 24.04.</p><p>The core is a <code>docker-compose.yml</code> containing:</p><div class=table-wrapper><table><thead><tr><th>Component</th><th>Description</th></tr></thead><tbody><tr><td>Headscale v0.28.0</td><td>Tailscale control plane</td></tr><tr><td>Authentik 2025.2.4</td><td>OIDC username/password login</td></tr><tr><td>PostgreSQL 16</td><td>Authentik database</td></tr><tr><td>Redis</td><td>Authentik cache</td></tr><tr><td>Nginx</td><td>HTTPS reverse proxy</td></tr></tbody></table></div><p>After deployment, two domains are ready:</p><ul><li><code>https://ts.example.com</code> â†’ Headscale control plane</li><li><code>https://auth.example.com</code> â†’ Authentik login management</li></ul><p>I won&rsquo;t expand on the detailed deployment process here (that&rsquo;s for another article), but the key points are:</p><ol><li><strong>Use acme.sh + Nginx for HTTPS</strong>, don&rsquo;t mess with fancy Traefik stuff</li><li><strong>Configure OIDC in Headscale</strong>, with Issuer pointing to Authentik</li><li><strong>Use <code>100.64.0.0/10</code> IP range</strong>, this is the CGNAT address range that won&rsquo;t conflict with internal networks</li></ol><h3 id=node-onboarding>Node Onboarding</h3><p>After setting up Headscale, getting any machine on the network is a one-line command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Install Tailscale client</span>
</span></span><span class=line><span class=cl>curl -fsSL https://tailscale.com/install.sh <span class=p>|</span> sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Connect to self-hosted control plane</span>
</span></span><span class=line><span class=cl>tailscale up --login-server<span class=o>=</span>https://ts.example.com --hostname<span class=o>=</span>your-hostname --accept-dns<span class=o>=</span><span class=nb>false</span>
</span></span></code></pre></td></tr></table></div></div><p>The terminal will output a link, open it in a browser, it jumps to the Authentik login page, enter username and password, authorizeâ€”node is on the network.</p><p>That simple.</p><p><strong>Key recommendation</strong>:</p><blockquote><p><strong>Don&rsquo;t rely on public cloud internal networks!</strong></p><p>Even if your Master nodes are in the same cloud, it&rsquo;s recommended to communicate uniformly through Tailscale.</p><p>The reason is simple: public cloud internal networks are black boxes. When you change machines or availability zones, internal IPs change.
While Tailscale IPs are allocated by you and won&rsquo;t change.</p><p>All nodes, whether cloud-based, local, or on other cloud platforms, should uniformly access via Tailscale for a clean network architecture.</p></blockquote><p>My current Tailscale network looks like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>100.64.0.2   lgb-macbookair-m4   macOS     â† My dev machine
</span></span><span class=line><span class=cl>100.64.0.3   haru                linux     â† Edge node
</span></span><span class=line><span class=cl>100.64.0.4   lgb-amd-3700        linux     â† Local Edge node
</span></span><span class=line><span class=cl>100.64.0.5   vm-16-12-ubuntu     linux     â† K3s Master
</span></span><span class=line><span class=cl>100.64.0.6   vm-0-8-ubuntu-new   linux     â† K3s Master (Primary)
</span></span><span class=line><span class=cl>100.64.0.7   vm-28-17-ubuntu     linux     â† K3s Master
</span></span><span class=line><span class=cl>100.64.0.8   rainyun-vja2g92e    linux     â† Overseas node
</span></span><span class=line><span class=cl>100.64.0.9   hc1                 linux     â† Edge node
</span></span><span class=line><span class=cl>100.64.0.10  ts-headscale        linux     â† Headscale control plane + K3s Master
</span></span><span class=line><span class=cl>100.64.0.12  ipv6radar           linux     â† Overseas node
</span></span><span class=line><span class=cl>100.64.0.13  localhost           android   â† Phone can join too (for slacking off)
</span></span></code></pre></td></tr></table></div></div><p>No matter where you are, <code>ping 100.64.0.6</code> works. This is what a proper internal network experience should be.</p><h2 id=part-ii-k3s-cluster-setup---based-on-tailscale-network>Part II: K3s Cluster Setup - Based on Tailscale Network</h2><h3 id=core-principles>Core Principles</h3><ol><li><strong>All Master nodes in the same cloud region</strong>â€”My 4 Masters are all in Tencent Cloud, low etcd sync latency</li><li><strong>Masters communicate using Tailscale IPs</strong>â€”Don&rsquo;t rely on cloud internal network</li><li><strong>Edge nodes anywhere</strong>â€”Home desktop, overseas VPS, office workstation, as long as Tailscale can reach</li><li><strong>Gateway nodes on high-bandwidth machines</strong>â€”Ingress runs on lightweight cloud with sufficient traffic</li></ol><h3 id=installing-masters>Installing Masters</h3><p>Installation is actually straightforward, just follow the official docs: <a class=link href=https://docs.k3s.io/quick-start target=_blank rel=noopener>https://docs.k3s.io/quick-start</a></p><p>But there are a few <strong>critical parameters</strong> you must pay attention to.</p><p><strong>First Master (initialize cluster)</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  <span class=nv>INSTALL_K3S_MIRROR</span><span class=o>=</span>cn <span class=se>\
</span></span></span><span class=line><span class=cl>  sh -s - server <span class=se>\
</span></span></span><span class=line><span class=cl>  --cluster-init <span class=se>\
</span></span></span><span class=line><span class=cl>  --flannel-iface<span class=o>=</span>tailscale0 <span class=se>\
</span></span></span><span class=line><span class=cl>  --node-ip<span class=o>=</span>100.64.0.6 <span class=se>\
</span></span></span><span class=line><span class=cl>  --tls-san<span class=o>=</span>100.64.0.6
</span></span></code></pre></td></tr></table></div></div><p><strong>Subsequent Masters joining cluster</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  <span class=nv>INSTALL_K3S_MIRROR</span><span class=o>=</span>cn <span class=se>\
</span></span></span><span class=line><span class=cl>  <span class=nv>K3S_TOKEN</span><span class=o>=</span><span class=s2>&#34;your-token&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  sh -s - server <span class=se>\
</span></span></span><span class=line><span class=cl>  --server https://100.64.0.6:6443 <span class=se>\
</span></span></span><span class=line><span class=cl>  --flannel-iface<span class=o>=</span>tailscale0 <span class=se>\
</span></span></span><span class=line><span class=cl>  --node-ip<span class=o>=</span><span class=k>$(</span>tailscale ip -4<span class=k>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  --tls-san<span class=o>=</span><span class=k>$(</span>tailscale ip -4<span class=k>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Core parameter explanation</strong>:</p><div class=table-wrapper><table><thead><tr><th>Parameter</th><th>Why it&rsquo;s necessary</th></tr></thead><tbody><tr><td><code>--cluster-init</code></td><td>First Master uses this, enables embedded etcd HA</td></tr><tr><td><code>--flannel-iface=tailscale0</code></td><td><strong>Most critical!</strong> Makes Flannel VXLAN use Tailscale NIC, not physical NIC</td></tr><tr><td><code>--node-ip=$(tailscale ip -4)</code></td><td>Node IP uses Tailscale IP, ensures cross-cloud communication</td></tr><tr><td><code>--tls-san=&lt;ip></code></td><td>API Server certificate includes Tailscale IP</td></tr><tr><td><code>INSTALL_K3S_MIRROR=cn</code></td><td>Domestic mirror acceleration, overseas nodes don&rsquo;t need</td></tr></tbody></table></div><p><code>--flannel-iface=tailscale0</code> is the hard-learned lesson after countless pitfalls.</p><p>Without this parameter, Flannel will default to using the physical NIC&rsquo;s IP (like public IP or cloud internal IP) to build VXLAN tunnels. The result isâ€”<strong>same-cloud nodes can communicate, cross-cloud nodes have complete Pod communication failure</strong>.</p><p>With this parameter, Flannel&rsquo;s VXLAN tunnels all go through the Tailscale virtual NIC, cross-cloud Pod communication is perfect.</p><h3 id=installing-edge-nodes>Installing Edge Nodes</h3><p>Edge nodes are Agents, even simpler.</p><p><strong>Domestic nodes</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  <span class=nv>K3S_URL</span><span class=o>=</span><span class=s2>&#34;https://100.64.0.6:6443&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  <span class=nv>K3S_TOKEN</span><span class=o>=</span><span class=s2>&#34;your-token&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  <span class=nv>INSTALL_K3S_MIRROR</span><span class=o>=</span>cn <span class=se>\
</span></span></span><span class=line><span class=cl>  sh -s - agent <span class=se>\
</span></span></span><span class=line><span class=cl>  --node-ip<span class=o>=</span><span class=k>$(</span>tailscale ip -4<span class=k>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  --flannel-iface<span class=o>=</span>tailscale0 <span class=se>\
</span></span></span><span class=line><span class=cl>  --node-label<span class=o>=</span><span class=s2>&#34;node.kubernetes.io/role=edge&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Overseas nodes</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sfL https://get.k3s.io <span class=p>|</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  <span class=nv>K3S_URL</span><span class=o>=</span><span class=s2>&#34;https://100.64.0.6:6443&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  <span class=nv>K3S_TOKEN</span><span class=o>=</span><span class=s2>&#34;your-token&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  sh -s - agent <span class=se>\
</span></span></span><span class=line><span class=cl>  --node-ip<span class=o>=</span><span class=k>$(</span>tailscale ip -4<span class=k>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  --flannel-iface<span class=o>=</span>tailscale0 <span class=se>\
</span></span></span><span class=line><span class=cl>  --node-label<span class=o>=</span><span class=s2>&#34;node.kubernetes.io/role=edge&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>The difference is domestic uses <code>rancher-mirror.rancher.cn</code>, overseas uses official <code>get.k3s.io</code>.</p><h3 id=domestic-docker-image-pulling-issues>Domestic Docker Image Pulling Issues</h3><p>I need to specifically mention: <strong>Docker/containerd image pulling in domestic environments is a big hassle.</strong></p><p>Docker Hub, ghcr.io, gcr.io and other image sources are basically semi-blocked in China. Some k3s built-in system component images (like <code>pause</code>, <code>coredns</code>, <code>metrics-server</code>) might not be pullable, causing nodes to stay NotReady.</p><p>Several solutions:</p><ol><li><strong>Configure image accelerators</strong>â€”Configure available domestic mirrors in <code>/etc/rancher/k3s/registries.yaml</code> (if you can still find live ones)</li><li><strong>Local export then import (recommended)</strong>â€”Pull images on overseas nodes or machines that can pull normally, export and transfer to domestic nodes for import:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Export on overseas node</span>
</span></span><span class=line><span class=cl>ctr -n k8s.io images <span class=nb>export</span> pause.tar registry.k8s.io/pause:3.9
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Transfer to domestic node</span>
</span></span><span class=line><span class=cl>scp pause.tar root@&lt;domestic-node-IP&gt;:/tmp/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Import on domestic node</span>
</span></span><span class=line><span class=cl>ctr -n k8s.io images import /tmp/pause.tar
</span></span></code></pre></td></tr></table></div></div></li><li><strong>Self-host Harbor image registry</strong>â€”If you have many nodes, it&rsquo;s recommended to set up a private image registry as a proxy cache, once and for all</li></ol><p>My approach is to pre-pull needed images on overseas nodes, then <code>ctr images export</code> to export, transfer through Tailscale internal network to domestic nodes, and <code>ctr images import</code> to import. Though crude, it&rsquo;s stable and reliable.</p><p>Get the token on the first Master:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /var/lib/rancher/k3s/server/node-token
</span></span></code></pre></td></tr></table></div></div><p>If everything&rsquo;s fine, you&rsquo;ll see new nodes online within seconds:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get nodes -o wide
</span></span><span class=line><span class=cl>NAME                 STATUS   ROLES                       AGE    VERSION
</span></span><span class=line><span class=cl>vm-0-8-ubuntu-new    Ready    control-plane,etcd,master   30d    v1.32.3+k3s1
</span></span><span class=line><span class=cl>vm-16-12-ubuntu      Ready    control-plane,etcd,master   30d    v1.32.3+k3s1
</span></span><span class=line><span class=cl>vm-28-17-ubuntu      Ready    control-plane,etcd,master   30d    v1.32.3+k3s1
</span></span><span class=line><span class=cl>vm-0-15-ubuntu       Ready    control-plane,etcd,master   1d     v1.32.3+k3s1
</span></span><span class=line><span class=cl>haru                 Ready    &lt;none&gt;                      20d    v1.32.3+k3s1
</span></span><span class=line><span class=cl>lgb-amd-3700         Ready    &lt;none&gt;                      15d    v1.32.3+k3s1
</span></span><span class=line><span class=cl>rainyun-ssh7pavp     Ready    &lt;none&gt;                      10d    v1.32.3+k3s1
</span></span><span class=line><span class=cl>hc1                  Ready    &lt;none&gt;                      5d     v1.32.3+k3s1
</span></span></code></pre></td></tr></table></div></div><p>All 8 nodes Ready.</p><p>Beautiful.</p><h3 id=about-gateway-nodes>About Gateway Nodes</h3><p>Ingress traffic entry requires public IP + sufficient bandwidth.</p><p>My approach:</p><ul><li><strong>Gateway nodes use lightweight cloud servers</strong>â€”Tencent Cloud Lighthouse, Alibaba Cloud Lighthouse, etc., monthly payment of tens of yuan, traffic package is sufficient</li><li><strong>k3s built-in Traefik Ingress</strong> runs on all nodes by default (DaemonSet), but only one or two nodes need to be exposed externally</li><li><strong>Domain DNS resolves to these lightweight cloud public IPs</strong></li></ul><p>Traffic path: <code>User request â†’ Lightweight cloud public IP â†’ Traefik Ingress â†’ Service â†’ Pod (can be on any node)</code></p><p>Even if the Pod is on an overseas node, no problemâ€”Flannel over Tailscale will route the traffic.</p><h2 id=part-iii-pitfall-chronicles>Part III: Pitfall Chronicles</h2><h3 id=pitfall-1-flannel-using-wrong-nic-hard-learned-lesson>Pitfall 1: Flannel Using Wrong NIC (Hard-learned Lesson)</h3><p><strong>Symptom</strong>: Edge node is Ready, but cross-node Pod communication fails completely.</p><p><strong>Cause</strong>: Didn&rsquo;t add <code>--flannel-iface=tailscale0</code>, Flannel defaulted to public network NIC.</p><p><strong>Diagnosis</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl describe node rainyun-ssh7pavp <span class=p>|</span> grep flannel
</span></span><span class=line><span class=cl><span class=c1># See flannel.alpha.coreos.com/public-ip using public IP instead of 100.64.0.x</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Solution</strong>: Uninstall k3s agent, reinstall with <code>--flannel-iface=tailscale0</code>.</p><p>This parameter is so important, say it three times:</p><ol><li><code>--flannel-iface=tailscale0</code></li><li><code>--flannel-iface=tailscale0</code></li><li><code>--flannel-iface=tailscale0</code></li></ol><h3 id=pitfall-2-unstable-tailscale-connection>Pitfall 2: Unstable Tailscale Connection</h3><p>A Vultr VPS had Tailscale connections dropping every few days.</p><p>Node kept bouncing between Ready and NotReady, kubelet frantically reporting <code>unable to update node status</code>.</p><p>Investigation revealed it was a VPN link issue, nothing to do with K3s.</p><p><strong>Solution</strong>: First use taint to isolate, later just replaced the machine.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl taint nodes vultr.guest node-problem<span class=o>=</span>true:NoSchedule --overwrite
</span></span><span class=line><span class=cl>kubectl taint nodes vultr.guest node-problem<span class=o>=</span>true:NoExecute --overwrite
</span></span></code></pre></td></tr></table></div></div><p>Lesson: <strong>Better to remove unstable nodes than struggle.</strong> Replacing with a new machine is faster than troubleshooting network issues.</p><h3 id=pitfall-3-dont-run-business-pods-on-low-spec-masters>Pitfall 3: Don&rsquo;t Run Business Pods on Low-spec Masters</h3><p>My fourth Master (vm-0-15-ubuntu) only has 2G memory and also runs the Headscale control plane.</p><p>If you let it run business Pods, it&rsquo;ll OOM in minutes.</p><p><strong>Solution</strong>: Add NoSchedule taint, only run control plane components + etcd.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl taint nodes vm-0-15-ubuntu node-role.kubernetes.io/control-plane<span class=o>=</span>:NoSchedule
</span></span></code></pre></td></tr></table></div></div><p>2G memory running k3s control-plane + etcd + Headscale full stack, CPU and memory usage around 60%, holds up fine.</p><h2 id=part-iv-troubleshooting-quick-reference>Part IV: Troubleshooting Quick Reference</h2><p>Node added but having issues? Check in this order:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. Check node status</span>
</span></span><span class=line><span class=cl>kubectl get nodes -o wide
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. Check node events</span>
</span></span><span class=line><span class=cl>kubectl describe node &lt;node-name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. Check Tailscale connectivity</span>
</span></span><span class=line><span class=cl>tailscale ping &lt;target-node-tailscale-IP&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. Check Flannel configuration</span>
</span></span><span class=line><span class=cl>kubectl describe node &lt;node-name&gt; <span class=p>|</span> grep flannel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. Check kubelet logs</span>
</span></span><span class=line><span class=cl>ssh root@&lt;node-IP&gt; <span class=s2>&#34;journalctl -u k3s-agent -n 50&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 6. Test cross-node Pod communication</span>
</span></span><span class=line><span class=cl>kubectl run <span class=nb>test</span> --image<span class=o>=</span>busybox --rm -it -- wget -qO- http://&lt;other-node-PodIP&gt;
</span></span></code></pre></td></tr></table></div></div><p>90% of issues can be found in the first 4 steps.</p><h2 id=part-v-summary>Part V: Summary</h2><p>Compared to the 2025 solution, key changes in this upgrade:</p><div class=table-wrapper><table><thead><tr><th>Item</th><th>2025</th><th>2026</th></tr></thead><tbody><tr><td>Networking</td><td>WireGuard manual config</td><td>Tailscale (Headscale self-hosted)</td></tr><tr><td>Control plane</td><td>Official Tailscale / manual WG</td><td>Self-hosted Headscale + OIDC</td></tr><tr><td>Master count</td><td>2</td><td>4 (HA)</td></tr><tr><td>Edge nodes</td><td>0</td><td>4</td></tr><tr><td>Total nodes</td><td>2</td><td>8</td></tr><tr><td>New node onboarding</td><td>Change lots of configs</td><td>One-line command</td></tr><tr><td>Cross-cloud communication</td><td>Flannel wireguard-native</td><td>Flannel VXLAN over Tailscale</td></tr><tr><td>Management complexity</td><td>High</td><td>Low</td></tr></tbody></table></div><p><strong>One-sentence solution summary</strong>:</p><ol><li><strong>Use Tailscale (Headscale self-hosted) for underlying network</strong>â€”All nodes uniformly join, don&rsquo;t rely on any public cloud internal network</li><li><strong>K3s Masters in same cloud region</strong>â€”Low etcd latency, stable control plane</li><li><strong>Edge nodes add freely</strong>â€”Home machines, overseas VPS, office workstations, as long as Tailscale can reach</li><li><strong>Gateway nodes use lightweight cloud</strong>â€”Cheap, sufficient bandwidth, fixed public IP</li></ol><p>The entire cluster has been running for a month, stable as an old dog.</p><p>8/8 nodes all available (previously had 1 Vultr with network issues, already replaced).</p><p>Done.</p><p>Entire article completed in the study at dawn, Happy New Year everyone~</p><p><em>Manual dog head emoji</em></p><hr><p><em>Related links:</em></p><ul><li><em>K3s Official Docs: <a class=link href=https://docs.k3s.io/ target=_blank rel=noopener>https://docs.k3s.io/</a></em></li><li><em>Headscale: <a class=link href=https://github.com/juanfont/headscale target=_blank rel=noopener>https://github.com/juanfont/headscale</a></em></li><li><em>Authentik: <a class=link href=https://goauthentik.io/ target=_blank rel=noopener>https://goauthentik.io/</a></em></li><li><em>Previous article: <a class=link href=https://liguobao.github.io/p/k3s-edge-computing-cluster/ target=_blank rel=noopener>Best Edge Computing Cluster Solution</a></em></li></ul><hr><p><em>This article was written with AI assistance.</em></p></section><footer class=article-footer><section class=article-tags><a href=/tags/k3s/>K3s</a>
<a href=/tags/tailscale/>Tailscale</a>
<a href=/tags/kubernetes/>Kubernetes</a>
<a href=/tags/2026/>2026</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/vibe-coding-deploy-tailscale/><div class=article-image><img src=/zh/p/vibe-coding-deploy-tailscale/logo.10bf2686f0c9b97299c4d0132f81bb64_hu_a7ff9109abcc5753.png width=250 height=150 loading=lazy alt="Featured image of post Who Doesn't Want Their Own Tailscale Private Network?" data-key=vibe-coding-deploy-tailscale data-hash="md5-EL8mhvDJuXKZxNATL4G7ZA=="></div><div class=article-details><h2 class=article-title>Who Doesn't Want Their Own Tailscale Private Network?</h2></div></a></article><article class=has-image><a href=/p/unitree-g1-develop-on-raspberry-pi/><div class=article-image><img src=/zh/p/unitree-g1-develop-on-raspberry-pi/logo.764fd995f255db159e0fd3c98a914fb3_hu_6a7c739f48c7a5dd.png width=250 height=150 loading=lazy alt="Featured image of post Unitree G1 Portable Development Guide: Raspberry Pi-based Development Environment" data-key=unitree-g1-develop-on-raspberry-pi data-hash="md5-dk/ZlfJV2xWeD9PJipFPsw=="></div><div class=article-details><h2 class=article-title>Unitree G1 Portable Development Guide: Raspberry Pi-based Development Environment</h2></div></a></article><article><a href=/p/gitlab-migration-low-version/><div class=article-details><h2 class=article-title>GitLab Low Version Migration Simple Tutorial</h2></div></a></article><article><a href=/p/linux-du/><div class=article-details><h2 class=article-title>Linux du Command</h2></div></a></article><article class=has-image><a href=/p/ubuntu-wifi-loss/><div class=article-image><img src=/zh/p/ubuntu-wifi-loss/xiaohei.affc1140e57282b122228f5d5d455d2f_hu_b0100a163c136d87.png width=250 height=150 loading=lazy alt="Featured image of post Ubuntu Ethernet Drops â€” Quick Reset Notes" data-key=ubuntu-wifi-loss data-hash="md5-r/wRQOVygrEiIo9dXUVdLw=="></div><div class=article-details><h2 class=article-title>Ubuntu Ethernet Drops â€” Quick Reset Notes</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=liguobao/liguobao.github.io issue-term=title crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 Life Deletion Guide</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>