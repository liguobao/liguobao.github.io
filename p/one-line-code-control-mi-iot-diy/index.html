<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Mi Home, Smart Home, Automation, HomeAssistant"><title>Control Your Mi Home Devices with One Line of Code</title><link rel=canonical href=https://liguobao.github.io/p/one-line-code-control-mi-iot-diy/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Control Your Mi Home Devices with One Line of Code"><meta property='og:description' content="Mi Home, Smart Home, Automation, HomeAssistant"><meta property='og:url' content='https://liguobao.github.io/p/one-line-code-control-mi-iot-diy/'><meta property='og:site_name' content='Life Deletion Guide'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='zhihu'><meta property='article:tag' content='2024'><meta property='article:published_time' content='2024-06-27T08:00:00+00:00'><meta property='article:modified_time' content='2024-06-27T08:00:00+00:00'><meta property='og:image' content='https://liguobao.github.io/zh/p/one-line-code-control-mi-iot-diy/mi-iot-diy.png'><meta name=twitter:title content="Control Your Mi Home Devices with One Line of Code"><meta name=twitter:description content="Mi Home, Smart Home, Automation, HomeAssistant"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://liguobao.github.io/zh/p/one-line-code-control-mi-iot-diy/mi-iot-diy.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/zhihu-lgb_hu_2ad0a9defe137384.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>üç•</span></figure><div class=site-meta><h1 class=site-name><a href=/>Life Deletion Guide</a></h1><h2 class=site-description>liguobao</h2></div></header><ol class=menu-social><li><a href=https://github.com/liguobao target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/Liguobao2049 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://www.zhihu.com/people/codelover target=_blank title=Áü•‰πé rel=me><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/liguobao-resume/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>About</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://liguobao.github.io/zh/>ÁÆÄ‰Ωì‰∏≠Êñá</option><option value=https://liguobao.github.io/ selected>English</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#preface>Preface</a></li><li><a href=#another-new-requirement>Another &ldquo;New Requirement&rdquo;</a></li><li><a href=#recent-practice>Recent Practice</a></li><li><a href=#getting-started-with-python-miio>Getting Started with python-miio</a><ol><li><a href=#get-device-ip-address-and-token>Get Device IP Address and Token</a></li></ol></li><li><a href=#control-devices>Control Devices</a><ol><li><a href=#control-modern-miot-devices>Control Modern (MIoT) Devices</a></li><li><a href=#device-status>Device Status</a></li><li><a href=#change-settings>Change Settings</a></li><li><a href=#use-actions>Use Actions</a></li></ol></li><li><a href=#control-your-mi-home-devices-with-one-line-of-code>Control Your Mi Home Devices with One Line of Code</a></li><li><a href=#summary>Summary</a></li><li><a href=#references>References</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/one-line-code-control-mi-iot-diy/><img src=/zh/p/one-line-code-control-mi-iot-diy/mi-iot-diy_hu_cb2a59fbce6dfed9.png srcset="/zh/p/one-line-code-control-mi-iot-diy/mi-iot-diy_hu_cb2a59fbce6dfed9.png 800w, /zh/p/one-line-code-control-mi-iot-diy/mi-iot-diy_hu_2458cf97436c2fe2.png 1600w" width=800 height=800 loading=lazy alt="Featured image of post Control Your Mi Home Devices with One Line of Code"></a></div><div class=article-details><header class=article-category><a href=/categories/zhihu/ style=background-color:#2a9d8f;color:#fff>Áü•‰πéÂõûÁ≠î</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/one-line-code-control-mi-iot-diy/>Control Your Mi Home Devices with One Line of Code</a></h2><h3 class=article-subtitle>Mi Home, Smart Home, Automation, HomeAssistant</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 27, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer><footer class=article-translations><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://liguobao.github.io/zh/p/one-line-code-control-mi-iot-diy/ class=link>ÁÆÄ‰Ωì‰∏≠Êñá</a></div></footer></div></header><section class=article-content><h2 id=preface>Preface</h2><p>Around last year or the year before, after switching phone to iOS, no Xiaoai classmate anymore, using Mi Home App to control Mi Home devices was really painful. So at that time, I tinkered with HomeAssistant solution, and wrote such an article.</p><p><a class=link href=https://zhuanlan.zhihu.com/p/444212384 target=_blank rel=noopener>Zhihu Column: Home Assistant Smart Home System Setup Guide (Mi Home + Siri)</a></p><p>This solution with HomePod speaker basically met my needs. Later, home basically had various devices, HomePod was basically the whole house central control.</p><p>Home Assistant running on home host 24/7, basically no issues, so didn&rsquo;t tinker for a long time.</p><h2 id=another-new-requirement>Another &ldquo;New Requirement&rdquo;</h2><p>At the beginning of the year, a big shot contacted me, asking if based on current Mi Home or other hardware devices, can do apartment smart home solution.</p><p>Based on the above experience, I gave some suggestions, but didn&rsquo;t research deeply.</p><p>At that time, let a certain 20-year teacher tinker with DIY control Mi Home devices solution, this friend&rsquo;s progress not ideal, finally no results.</p><p>Just at that time knew there is a <a class=link href=https://github.com/rytilahti/python-miio target=_blank rel=noopener>github.com/rytilahti/python-miio</a> good tool.</p><ul><li>Python library & console tool for controlling Xiaomi smart appliances</li><li>A Python library and console tool for controlling Xiaomi smart home devices</li></ul><p>Interesting, Mark it.</p><h2 id=recent-practice>Recent Practice</h2><p>Recently, again because of some strange requirements, need to &ldquo;seriously&rdquo; tinker with Mi Home device control solution.</p><p>Earliest when doing solution verification, even used Appium to simulate operating Mi Home App, but lag, slow, unstable&mldr;</p><p>To these two weeks entering formal practice stage, decided to use python-miio, although Hack, but definitely more stable than Appium.</p><p>So, let&rsquo;s start.</p><h2 id=getting-started-with-python-miio>Getting Started with python-miio</h2><p>First, install python-miio locally</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Remember, do not directly install pip install python-miio</span>
</span></span><span class=line><span class=cl><span class=c1># Default Release version is 0.5.12, 2022 version</span>
</span></span><span class=line><span class=cl>pip install python-miio<span class=o>==</span>0.6.0.dev0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Or directly install latest version from Github</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pip install git+https://github.com/rytilahti/python-miio.git
</span></span></code></pre></td></tr></table></div></div><p>After installing, local command line should have miiocli command line tool.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚ûú  ~ miiocli --help
</span></span><span class=line><span class=cl>Usage: miiocli <span class=o>[</span>OPTIONS<span class=o>]</span> COMMAND <span class=o>[</span>ARGS<span class=o>]</span>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>  -d, --debug
</span></span><span class=line><span class=cl>  -o, --output <span class=o>[</span>default<span class=p>|</span>json<span class=p>|</span>json_pretty<span class=o>]</span>
</span></span><span class=line><span class=cl>  --version                       Show the version and exit.
</span></span><span class=line><span class=cl>  --help                          Show this message and exit.
</span></span></code></pre></td></tr></table></div></div><p>Normally, we should be able to control our Mi Home devices through miiocli.</p><p>First, we need to find our device&rsquo;s IP address and Token.</p><p>All subsequent operations are based on these two pieces of information.</p><h3 id=get-device-ip-address-and-token>Get Device IP Address and Token</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>‚ûú  ~ miiocli cloud
</span></span><span class=line><span class=cl>Username: your Xiaomi account
</span></span><span class=line><span class=cl>Password: your <span class=nv>password</span>
</span></span><span class=line><span class=cl><span class=o>==</span> Xiaomi Smart Camera C400 <span class=o>(</span>Device online <span class=o>)</span> <span class=o>==</span>
</span></span><span class=line><span class=cl>    Model: chuangmi.camera.039a01
</span></span><span class=line><span class=cl>    Token: XXX
</span></span><span class=line><span class=cl>    IP: 192.168.31.170 <span class=o>(</span>mac: 94:F8:27:05:5B:AA<span class=o>)</span>
</span></span><span class=line><span class=cl>    DID: <span class=m>1029838640</span>
</span></span><span class=line><span class=cl>    Locale: <span class=nv>cn</span>
</span></span><span class=line><span class=cl><span class=o>==</span> Xiaomi Smart Camera <span class=o>(</span>Device online <span class=o>)</span> <span class=o>==</span>
</span></span><span class=line><span class=cl>    Model: chuangmi.camera.029a02
</span></span><span class=line><span class=cl>    Token: XXX
</span></span><span class=line><span class=cl>    IP: 192.168.31.233 <span class=o>(</span>mac: 60:7E:A4:C0:E6:26<span class=o>)</span>
</span></span><span class=line><span class=cl>    DID: <span class=m>525571884</span>
</span></span><span class=line><span class=cl>    Locale: <span class=nv>cn</span>
</span></span><span class=line><span class=cl><span class=o>==</span> Smart Plug-Ubuntu <span class=o>(</span>Device online <span class=o>)</span> <span class=o>==</span>
</span></span><span class=line><span class=cl>    Model: chuangmi.plug.212a01
</span></span><span class=line><span class=cl>    Token: XXX
</span></span><span class=line><span class=cl>    IP: 192.168.31.141 <span class=o>(</span>mac: 58:B6:23:EB:11:EF<span class=o>)</span>
</span></span><span class=line><span class=cl>    DID: <span class=m>433609370</span>
</span></span><span class=line><span class=cl>    Locale: cn
</span></span></code></pre></td></tr></table></div></div><p>Here basically can see devices under your account, then we can control these devices through miiocli commands.</p><h2 id=control-devices>Control Devices</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># This is a camera device</span>
</span></span><span class=line><span class=cl>‚ûú  ~ miiocli device --ip 192.168.31.170 --token xxxx info
</span></span><span class=line><span class=cl>Running <span class=nb>command</span> info
</span></span><span class=line><span class=cl>Model: chuangmi.camera.039a01
</span></span><span class=line><span class=cl>Hardware version: Linux
</span></span><span class=line><span class=cl>Firmware version: 5.1.6_0420
</span></span><span class=line><span class=cl>Supported using: GenericMiot
</span></span><span class=line><span class=cl>Command: miiocli genericmiot --ip 192.168.31.170 --token xxxx
</span></span><span class=line><span class=cl>Supported by genericmiot: True
</span></span></code></pre></td></tr></table></div></div><p>Here need to pay attention to Supported by genericmiot, if have this, basically can control this device through miiocli genericmiot.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl># Supported by genericmiot: True
</span></span><span class=line><span class=cl>Note that the command field which gives you the direct command to use for controlling the device.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>If the device is supported by the genericmiot integration as stated in the output,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>you can also use miiocli genericmiot for controlling it.
</span></span></code></pre></td></tr></table></div></div><p><img src=/img/miiocli.png loading=lazy alt="miiocli screenshot"></p><p>The following documentation excerpted and translated from official docs.</p><h3 id=control-modern-miot-devices>Control Modern (MIoT) Devices</h3><p>Most modern (MIoT) devices will automatically be supported by genericmiot integration.</p><p>Internally, it uses (&ldquo;miot spec&rdquo;) files to understand supported features like sensors, settings, and actions.</p><ul><li><a class=link href=https://home.miot-spec.com/spec/xiaomi.controller.86v1 target=_blank rel=noopener>https://home.miot-spec.com/spec/xiaomi.controller.86v1</a></li><li><a class=link href=https://home.miot-spec.com/ target=_blank rel=noopener>Mi Home Product Library (Unofficial)</a></li></ul><p>This device model specific file will be downloaded (and cached locally) when you first use genericmiot integration.</p><p>All supported device features can be controlled using common commands: status (show device status), set (change settings), actions list available actions, and call execute actions.</p><h3 id=device-status>Device Status</h3><p>Executing status will show current device status, and acceptable values for settings (marked with access RW):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>miiocli genericmiot --ip 127.0.0.1 --token <span class=m>00000000000000000000000000000000</span> status
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service Light <span class=o>(</span>light<span class=o>)</span>
</span></span><span class=line><span class=cl>        Switch Status <span class=o>(</span>light:on, access: RW<span class=o>)</span>: False <span class=o>(</span>&lt;class <span class=s1>&#39;bool&#39;</span>&gt;, <span class=o>)</span>
</span></span><span class=line><span class=cl>        Brightness <span class=o>(</span>light:brightness, access: RW<span class=o>)</span>: <span class=m>60</span> % <span class=o>(</span>&lt;class <span class=s1>&#39;int&#39;</span>&gt;, min: 1, max: 100, step: 1<span class=o>)</span>
</span></span><span class=line><span class=cl>        Power Off Delay Time <span class=o>(</span>light:off-delay-time, access: RW<span class=o>)</span>: 1:47:00 <span class=o>(</span>&lt;class <span class=s1>&#39;int&#39;</span>&gt;, min: 0, max: 120, step: 1<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=change-settings>Change Settings</h3><p>To change settings, you need to provide the setting name (e.g., in the above example light:brightness):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl> miiocli genericmiot --ip 127.0.0.1 --token <span class=m>00000000000000000000000000000000</span> <span class=nb>set</span> light:brightness <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=o>[{</span><span class=s1>&#39;did&#39;</span>: <span class=s1>&#39;light:brightness&#39;</span>, <span class=s1>&#39;siid&#39;</span>: 2, <span class=s1>&#39;piid&#39;</span>: 3, <span class=s1>&#39;code&#39;</span>: 0<span class=o>}]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=use-actions>Use Actions</h3><p>Most devices will also provide actions:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>miiocli genericmiot --ip 127.0.0.1 --token <span class=m>00000000000000000000000000000000</span> actions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Light <span class=o>(</span>light<span class=o>)</span>
</span></span><span class=line><span class=cl>        light:toggle            Toggle
</span></span><span class=line><span class=cl>        light:brightness-down   Brightness Down
</span></span><span class=line><span class=cl>        light:brightness-up     Brightness Up
</span></span></code></pre></td></tr></table></div></div><p>These can be executed using the call command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>miiocli genericmiot --ip 127.0.0.1 --token <span class=m>00000000000000000000000000000000</span> call light:toggle
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s1>&#39;code&#39;</span>: 0, <span class=s1>&#39;out&#39;</span>: <span class=o>[]}</span>
</span></span></code></pre></td></tr></table></div></div><p>Use miiocli genericmiot &ndash;help for more available commands.</p><p>Detailed docs here:</p><ul><li><a class=link href="https://github.com/rytilahti/python-miio?tab=readme-ov-file#controlling-modern-miot-devices" target=_blank rel=noopener>https://github.com/rytilahti/python-miio?tab=readme-ov-file#controlling-modern-miot-devices</a></li></ul><h2 id=control-your-mi-home-devices-with-one-line-of-code>Control Your Mi Home Devices with One Line of Code</h2><p>Based on the above operations, this one line of code came out.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Get executable commands</span>
</span></span><span class=line><span class=cl>miiocli genericmiot --ip 192.168.31.170 --token xxxx actions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## Execute action</span>
</span></span><span class=line><span class=cl>miiocli genericmiot --ip 192.168.31.170 --token xxxx call camera:record-start
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## Change property</span>
</span></span><span class=line><span class=cl>miiocli genericmiot --ip 192.168.31.170 --token xxxx <span class=nb>set</span> camera:record-mode <span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><p>Of course if you need to write some code yourself, it&rsquo;s like this.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>miio</span> <span class=kn>import</span> <span class=n>Device</span><span class=p>,</span> <span class=n>DeviceFactory</span><span class=p>,</span> <span class=n>DeviceStatus</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>loguru</span> <span class=kn>import</span> <span class=n>logger</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MiIotDevice</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ip</span><span class=p>,</span> <span class=n>token</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>device</span><span class=p>:</span> <span class=n>Device</span> <span class=o>=</span> <span class=n>DeviceFactory</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>ip</span><span class=p>,</span> <span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>device_info</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_info</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Device: </span><span class=si>{</span><span class=n>ip</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>token</span><span class=si>}</span><span class=s2> created&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>load_status</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>device</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>d_status</span><span class=p>:</span> <span class=n>DeviceStatus</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>device</span><span class=o>.</span><span class=n>status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>d_status</span><span class=o>.</span><span class=n>data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_info</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ip&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>device</span><span class=o>.</span><span class=n>ip</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;model&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>device</span><span class=o>.</span><span class=n>model</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;device_id&#34;</span><span class=p>:</span> <span class=s2>&#34;nx_&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>device</span><span class=o>.</span><span class=n>device_id</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;mi_device_id&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>device</span><span class=o>.</span><span class=n>device_id</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>call_action</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>args</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>device</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Device not ready&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>call_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>device</span><span class=o>.</span><span class=n>call_action</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;call_action: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>args</span><span class=si>}</span><span class=s2> result: </span><span class=si>{</span><span class=n>call_result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>call_result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set_properties</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>properties</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>device</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Device not ready&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>call_result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>device</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=s2>&#34;set_properties&#34;</span><span class=p>,</span> <span class=n>properties</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;set_properties: </span><span class=si>{</span><span class=n>properties</span><span class=si>}</span><span class=s2> finish, result: </span><span class=si>{</span><span class=n>call_result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>call_result</span>
</span></span></code></pre></td></tr></table></div></div><p>Basically, as above.</p><h2 id=summary>Summary</h2><p>python-miio is a good tool for controlling Mi Home devices</p><ul><li>Through miiocli can conveniently control devices</li><li>Through miiocli genericmiot can control modern devices</li><li>Through miiocli genericmiot actions can view device supported actions</li><li>Through miiocli genericmiot status can view device status</li><li>Through miiocli genericmiot set can change device properties</li><li>Through miiocli genericmiot call can execute device actions</li><li>Through miiocli genericmiot &ndash;help can view more commands</li></ul><p>At the same time can write code to tinker with specific devices, making some automation things also simple.</p><p>Wish everyone have fun~</p><h2 id=references>References</h2><ul><li><a class=link href=https://github.com/rytilahti/python-miio target=_blank rel=noopener>python-miio</a></li><li><a class=link href=https://home.miot-spec.com/ target=_blank rel=noopener>miot-spec Mi Home Device Properties Query (Unofficial)</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/zhihu/>Zhihu</a>
<a href=/tags/2024/>2024</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/zhihu-salon-0728/><div class=article-details><h2 class=article-title>Zhihu Salon ‚Äî 2024-07-28 Notes</h2></div></a></article><article class=has-image><a href=/p/vs-git-bash/><div class=article-image><img src=/zh/p/vs-git-bash/bash.fc8d6b65f713526326167e8ae70e02b5_hu_b494b6591790bdbe.jpg width=250 height=150 loading=lazy alt="Featured image of post Add Git Bash to Terminal in Visual Studio" data-key=vs-git-bash data-hash="md5-/I1rZfcTUmMmFn6K5w4CtQ=="></div><div class=article-details><h2 class=article-title>Add Git Bash to Terminal in Visual Studio</h2></div></a></article><article class=has-image><a href=/p/android-magisk-install/><div class=article-image><img src=/zh/p/android-magisk-install/logo.0bd0197c8b306596de537bc57749afd7_hu_95e1bd98922fb89e.png width=250 height=150 loading=lazy alt="Featured image of post Start Your Android Tinkering Journey with Magisk" data-key=android-magisk-install data-hash="md5-C9AZfIswZZbeU3vFd0mv1w=="></div><div class=article-details><h2 class=article-title>Start Your Android Tinkering Journey with Magisk</h2></div></a></article><article class=has-image><a href=/p/q-cloud-api-down-k3s-up/><div class=article-image><img src=/zh/p/q-cloud-api-down-k3s-up/qcloud.70ff526e01557f1bd1b0a5ce29822e24_hu_3a89b9f3391e81c6.png width=250 height=150 loading=lazy alt="Featured image of post Tencent Cloud API Gateway Sunset? Open-Source Cluster Replacement" data-key=q-cloud-api-down-k3s-up data-hash="md5-cP9SbgFVfxvRsKXOKYIuJA=="></div><div class=article-details><h2 class=article-title>Tencent Cloud API Gateway Sunset? Open-Source Cluster Replacement</h2></div></a></article><article class=has-image><a href=/p/gpt2077-free-gpt4/><div class=article-image><img src=/zh/p/gpt2077-free-gpt4/girl.a1f1a425f999bed6a2f40e1f42572d76_hu_9467b99c25fedc5f.png width=250 height=150 loading=lazy alt="Featured image of post GPT2077 Free GPT4 Site~" data-key=gpt2077-free-gpt4 data-hash="md5-ofGkJfmZvtai9A4fQlctdg=="></div><div class=article-details><h2 class=article-title>GPT2077 Free GPT4 Site~</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=liguobao/liguobao.github.io issue-term=title crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 Life Deletion Guide</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>